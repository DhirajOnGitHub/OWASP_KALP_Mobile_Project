
<!DOCTYPE HTML>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/splash-icon.png">
<link rel="apple-touch-startup-image" href="images/splash-screen.png" 			media="screen and (max-device-width: 320px)" />  
<link rel="apple-touch-startup-image" href="images/splash-screen@2x.png" 		media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" /> 
<link rel="apple-touch-startup-image" sizes="640x1096" href="images/splash-screen@3x.png" />
<link rel="apple-touch-startup-image" sizes="1024x748" href="images/splash-screen-ipad-landscape" media="screen and (min-device-width : 481px) and 
(max-device-width : 1024px) 
and (orientation : landscape)" />
<link rel="apple-touch-startup-image" sizes="768x1004" href="images/splash-screen-ipad-portrait.png" media="screen and (min-device-width : 481px) and 
(max-device-width : 
1024px) and (orientation : portrait)" />
<link rel="apple-touch-startup-image" sizes="1536x2008" href="images/splash-screen-ipad-portrait-retina.png"   media="(device-width: 768px)	and (orientation: 
portrait)	and 
(-webkit-device-pixel-ratio: 2)"/>
<link rel="apple-touch-startup-image" sizes="1496x2048" href="images/splash-screen-ipad-landscape-retina.png"   media="(device-width: 768px)	and 
(orientation: landscape)	
and (-webkit-device-pixel-ratio: 2)"/>

<title>OWASP TOP 10 Android App - Version 1.0</title>

<link href="css/style.css"     		 rel="stylesheet" type="text/css">
<link href="css/framework.css" 		 rel="stylesheet" type="text/css">
<link href="css/owl.carousel.css" 	 rel="stylesheet" type="text/css">
<link href="css/owl.theme.css" 		 rel="stylesheet" type="text/css">
<link href="css/swipebox.css"		 rel="stylesheet" type="text/css">
<link href="css/colorbox.css"		 rel="stylesheet" type="text/css">
<link href="css/font-awesome.css"	 rel="stylesheet" type="text/css">
<link href="css/animate.css"		 rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jqueryui.js"></script>
<script type="text/javascript" src="js/wow.js"></script>
<script type="text/javascript" src="js/owl.carousel.min.js"></script>
<script type="text/javascript" src="js/jquery.swipebox.js"></script>
<script type="text/javascript" src="js/colorbox.js"></script>
<script type="text/javascript" src="js/snap.js"></script>
<script type="text/javascript" src="js/countdown.js"></script>
<script type="text/javascript" src="js/contact.js"></script>
<script type="text/javascript" src="js/framework.js"></script>
<script type="text/javascript" src="js/framework.launcher.js"></script>
<script type="text/javascript" src="js/custom.js"></script>
<script type="text/javascript" src="js/cheatsheet.js"></script>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/hyperlink.js"></script>


</head>
<body class="body">

<div id="preloader" style="display:none;">
			<img id="image-homepage" class="animate fadeIn" data-wow-duration="1.5s" src="images/00001.jpg" alt="img" style="float:center; width:100% auto; 
height:80% auto;">									
		
</div>


<div class="header">
    <a class="deploy-navigation going-up" href="#">
        <i class="fa fa-navicon"></i>
    </a>
    <a class="header-logo" href="#"><img src="images/title/owasp_logo_header_1600_310.png" alt="img"></a>
</div>

<div class="header-clear"></div>

<div class="page-navigation full-bottom">
	<div class="nav-clear"></div>
    <div class="nav-item">
        <a href="index.html">
            <i class="fa fa-star"></i>				
            Welcome		
            <i class="fa fa-angle-right"></i>
        </a>
    </div>
    <div class="nav-item">
        <a href="homepage.html">
            <i class="fa fa-home"></i>				
            Homepage		
            <i class="fa fa-angle-right"></i>
        </a>
    </div>	
	<div class="nav-item">
        <a href="cheatsheets.html">
            <i class="fa fa-list-alt"></i>
            Cheat Sheets
            <i class="fa fa-circle"></i>
        </a>       
    </div>
    <div class="nav-item">
        <a href="email.html">
            <i class="fa fa-envelope"></i>
            Email OWASP Top 10 
            <i class="fa fa-angle-right"></i>
        </a>       
    </div>
    <div class="nav-item">
        <a href="download.html">
            <i class="fa fa-cloud-download"></i>
            Download OWASP Top 10 
            <i class="fa fa-angle-right"></i>
        </a>        
    </div>
    <div class="nav-item">
        <a href="about.html">
            <i class="fa fa-info"></i>
            About OWASP KALP
            <i class="fa fa-angle-right"></i>
        </a>
        
    </div>
    <div class="nav-item">
        <a href="tnc.html">
            <i class="fa fa-exclamation-triangle"></i>
            Disclaimer
            <i class="fa fa-angle-right"></i>
        </a>        
    </div>
    <div class="nav-item">
        <a href="contact.html">
            <i class="fa fa-phone-square"></i>
            Contact	
            <i class="fa fa-angle-right"></i>
        </a>       
    </div>
    <div class="nav-item">
        <a href="#" class="close-navigation">
            <i class="fa fa-times"></i>
            Close	
            <i class="fa fa-angle-up"></i>
        </a>       
    </div>
</div>    

<div class="content-cheatsheets" id="content-cheatsheets">	   

    <div class="container">  
	<div class="static-notification-blue" id="title">
			<p class="center-text uppercase">OWASP Top 10 Cheat Sheets</p>   
	</div>
			<div class="">
               <a class="checkbox checkbox-one" style="float:right;" id="cheatsheetcbox" onclick="toggleall();">Expand/Collapse</a>               
            </div>
		
		<table id="cheatsheet-table">
		<tbody>
			<tr id="details1" onClick="toggle();">
			 	<td id="cheatsheet-table-row">	
				  <a href="#title" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">1.</h1>
					</div>	
					<div id="option-header-layout">												
						<strong id="option-header-label">Authentication </strong>
					</div>
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>				 	
				  </a>			
				  <div class="decoration_blank" id="one"></div>	  
				</td>
			</tr>
					<tr id="row1"> 
						<td id="row-details">
						<ol type="A">
							<h4><li><span id="Implement_Proper_Password_Strength_Controls">Implement Proper Password Strength Controls</span></li>
							</h4>
							<div class="decoration"></div>				
								<p>A key concern when using passwords for authentication is password strength. A "strong" password policy makes it difficult 
								or even improbable for one to guess the password through either manual or automated means. The following characteristics 
								define a strong password:</p>
						<ol type="a">
								<h5><li><span class="mw-headline" id="Password_Length">Password Length</span></li></h3>
									<p id="para">Longer passwords provide a greater combination of characters and consequently make it more difficult for an attacker to guess. </p>
										<ul>
											<li> <b>Minimum</b> length of the passwords should be <b>enforced</b> by the application.
										<ul type="circle">
											<li> Passwords <b>shorter than 10 characters</b> are considered to be weak.
											</li>
										</ul>
											</li>
										</ul>
									<p id="para">While minimum length enforcement may cause problems with memorizing passwords among some users, applications should encourage them 
											to set <i>passphrases</i> (sentences or combination of words) that can be much longer than typical passwords and yet much easier to 
											remember.
									</p>
										<ul>
											<li> <b>Maximum</b> password length should not be set <b>too low</b>, as it will prevent users from creating passphrases. Typical 
												maximum length is 128 characters.
											<ul type="circle">
												<li> 
													Passphrases shorter than 20 characters are usually considered weak if they only consist of lower case Latin characters.
												</li>
											</ul>
											</li>
										</ul>
										<ul>
									<li> Every character counts!!
										<ul type="circle">
											<li>Make sure that every character the user types in is actually included in the password. We've seen systems that truncate the 
												password at a length shorter than what the user provided (e.g., truncated at 15 characters when they entered 20).
											</li>
											<li>This is usually handled by setting the length of ALL password input fields to be exactly the same length as the maximum 
												length password. This is particularly important if your max password length is short, like 20-30 characters.
											</li>
										</ul>
									</li>
										</ul>
							<h5><li><span  id="Password_Complexity">Password Complexity</span></li></h3>
						<p id="para">Applications should enforce password complexity rules to discourage easy to guess passwords. Password mechanisms should allow 
							virtually any character the user can type to be part of their password, including the space character. Passwords should, obviously, 
							be case sensitive in order to increase their complexity. Occasionally, we find systems where passwords aren't case sensitive, 
							frequently due to legacy system issues like old mainframes that didn't have case sensitive passwords.</p>
						<p id="para">The password change mechanism should require a minimum level of complexity that makes sense for the application and its user 
							population. For example:</p>
							<ul>
								<li>Password must meet at least 3 out of the following 4 complexity rules
								<ul type="circle">
								<li>at least 1 uppercase character (A-Z) 
								</li>
								<li>at least 1 lowercase character (a-z) 
								</li>
								<li>at least 1 digit (0-9) 
								</li>
								<li>at least 1 special character (punctuation) &#8212; do not forget to treat space as special characters too
								</li>
								</ul>
								</li>
								<li>at least 10 characters 
								</li>
								<li>at most 128 characters
								</li>
								<li>not more than 2 identical characters in a row (e.g., 111 not allowed)
								</li>
							</ul>
						<p id="para">As application's require more complex password policies, they need to be very clear about what these policies are.</p>
							<ul>
							<li>The required policy needs to be explicitly stated on the password change page
							<ul type="circle">
							<li> be sure to list every special character you allow, so it's obvious to the user
							</li>
							</ul>
							</li>
							</ul>
						<p id="para">Recommendation:</p>
							<ul>
							<li> Ideally, the application would indicate to the user as they type in their new password how much of the complexity policy 
								their new password meets
							<ul type="circle">
							<li>In fact, the submit button should be grayed out until the new password meets the complexity policy and the 2nd copy of the 
								new password matches the 1st. This will make it far easier for the user to understand and comply with your complexity policy.
							</li>
							</ul>
							</li>
							</ul>
						<p id="para">Regardless of how the UI behaves, when a user submits their password change request:</p>
							<ul>
							<li>If the new password doesn't comply with the complexity policy, the error message should describe EVERY complexity rule that 
								the new password does not comply with, not just the 1st rule it doesn't comply with
							</li>
							</ul>
						<p id="para">Changing passwords should be EASY, not a hunt in the dark.</p>
						</ol>
						<h4><li><span id="Implement_Secure_Password_Recovery_Mechanism">Implement Secure Password Recovery Mechanism</span></li></h4>
						<div class="decoration"></div>
					
							<p id="para">It is common for an application to have a mechanism that provides a means for a user to gain access to their account in the event 
								they forget their password. Please see <a id="hyperlink" href="javascript:loadURL('https:/www.owasp.org/index.php/Forgot_Password_Cheat_Sheet');" title="Forgot Password Cheat Sheet">Forgot 
								Password Cheat Sheet</a> for details on this feature.</p>
						
						<h4><li><span id="Require_Re-authentication_for_Sensitive_Features">Require Re-authentication for Sensitive Features</span></li></h4>
						<div class="decoration"></div>
					
							<p id="para">In order to mitigate CSRF and session hijacking, it's important to require the current credentials for an account before updating 
								sensitive account information such as the user's password, user's email, or before sensitive transactions, such as shipping a 
								purchase to a new address.  Without this countermeasure, an attacker may be able to execute sensitive transactions through a CSRF or 
								XSS attack without needing to know the user's current credentials.  Additionally, an attacker may get temporary physical access to a 
								user's browser or steal their session ID to take over the user's session.</p>
						
						<h4><li><span id="Store_Passwords_in_a_Secure_Fashion">Store Passwords in a Secure Fashion</span></li></h2>
						<div class="decoration"></div>
					
							<p id="para">It is critical for a application to store a password using the right cryptographic technique. Please see <a id="hyperlink" href=
								"javascript:loadURL('https:/www.owasp.org/index.php/Password_Storage_Cheat_Sheet');" title="Password Storage Cheat Sheet">Password Storage Cheat Sheet</a> for details on this 
								feature.</p>						
							
						<h4><li><span id="Authentication_and_Error_Messages">Authentication and Error Messages</span></li></h4>
						<div class="decoration"></div>
					
						<p id="para">Incorrectly implemented error messages in the case of authentication functionality can be used for the purposes of user ID and 
								password enumeration. An application should respond (both HTTP and HTML) in a generic manner.</p>
							<h4><span id="Authentication_Responses">
							<ol type="a">
							<li>Authentication Responses</li>
							</span></h4>
								<p id="para">An application should respond with a generic error message regardless of whether the user ID or password was incorrect. It 
									should also give no indication to the status of an existing account.</p>
							<h4><span id="Error_Codes_and_URL.27s">
							<li>Error Codes and URL's</li>
							</span></h4>
								<p id="para">The application may return a different HTTP Error code depending on the authentication attempt response. It may respond 
								with a 200 for a positive result and a 403 for a negative result. Even though a generic error page is shown to a user, the 
								HTTP response code may differ which can leak information about whether the account is valid or not.</p>
								</ol>
								<h4><li><span id="Prevent_Brute-Force_Attacks">Prevent Brute-Force Attacks</span></li></h4>
							<div class="decoration"></div>				
								<p id="para">If an attacker is able to guess passwords without the account becoming disabled due to failed authentication attempts, the 
								attacker has an opportunity to continue with a brute force attack until the account is compromised.  Automating 
								brute-force/password guessing attacks on web applications is a trivial challenge. Password lockout mechanisms should be 
								employed that lock out an account if more than a preset number of unsuccessful login attempts are made.  Password lockout 
								mechanisms have a logical weakness. An attacker that undertakes a large number of authentication attempts on known account 
								names can produce a result that locks out entire blocks of user accounts.  Given that the intent of a password lockout system 
								is to protect from brute-force attacks, a sensible strategy is to lockout accounts for a period of time (e.g., 20 minutes). 
								This significantly slows down attackers, while allowing the accounts to reopen automatically for legitimate users.</p>
								<p id="para">
								Also, multi-factor authentication is a very powerful deterrent when trying to prevent brute force attacks since the 
								credentials are a moving target. When multi-factor is implemented and active, account lockout may no longer be necessary.</p>
									
								
							</ol>
						</td>
					</tr>			
			<tr id="details2" onClick="toggle2();">
				<td id="cheatsheet-table-row">		 
    			  <a href="#cheatsheetcbox" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">2.</h1>
					</div>				
					<div id="option-header-layout">					
						<strong id="option-header-label">Session Management</strong>
					</div>
					<i class="fa fa-angle-down"  id="option-header-label-arrow"></i>
				   </a>
				   <div class="decoration_blank" id="two"></div>
				</td>
			</tr>
					<tr id="row2">
				<td class="container" id="row-details">
				<ol type="A">
					<h4><li><span id="Session_ID_Properties">Session ID Properties</span></li></h4>
							<p>In order to keep the authenticated state and track the users progress within the web application, applications provide users 
								with a session identifier (session ID or token) that is assigned at session creation time, and is shared and exchanged by the 
								user and the web application for the duration of the session (it is sent on every HTTP request). The session ID is a "name=value" 
								pair. 
							</p>
							<p id="para1">With the goal of implementing secure session IDs, the generation of identifiers (IDs or tokens) must meet the following 
								properties: 
							</p>
								<ol type="a">
								<h5><li><span id="Session_ID_Name_Fingerprinting">Session ID Name Fingerprinting</span></li></h5>
									<p id="para1">The name used by the session ID should not be extremely descriptive nor offer unnecessary details about the purpose and 
										meaning of the ID. </p>
									<p id="para1">The session ID names used by the most common web application development frameworks can be easily fingerprinted [0], such as 
										PHPSESSID (PHP), JSESSIONID (J2EE), CFID &amp; CFTOKEN (ColdFusion), ASP.NET_SessionId (ASP .NET), etc. Therefore, the session ID 
										name can disclose the technologies and programming languages used by the web application. </p>
									<p id="para1">It is recommended to change the default session ID name of the web development framework to a generic name, such as "id". </p>
									
								<h5><li><span id="Session_ID_Length">Session ID Length</span></li></h5>
									<p id="para1">The session ID must be long enough to prevent brute force attacks, where an attacker can go through the whole range of ID 
										values and verify the existence of valid sessions. </p>
									<p id="para1">The session ID length must be at least 128 bits (16 bytes). 						</p>				
								<h5><li><span id="Session_ID_Content_.28or_Value.29">Session ID Content (or Value)</span></li></h5>
									<p id="para1">The session ID content (or value) must be meaningless to prevent information disclosure attacks, where an attacker is able to 
										decode the contents of the ID and extract details of the user, the session, or the inner workings of the web application. </p>
									<p id="para1">The session ID must simply be an identifier on the client side, and its value must never include sensitive information (or 
										PII). The meaning and business or application logic associated to the session ID must be stored on the server side, and 
										specifically, in session objects or in a session management database or repository. The stored information can include the client 
										IP address, User-Agent, e-mail, username, user ID, role, privilege level, access rights, language preferences, account ID, 
										current state, last login, session timeouts, and other internal session details. If the session objects and properties contain 
										sensitive information, such as credit card numbers, it is required to duly encrypt and protect the session management repository. 
										</p>
									<p id="para1">It is recommended to create cryptographically strong session IDs through the usage of cryptographic hash functions such as 
										SHA1 (160 bits). </p>
											
								</ol>
					<h4><li><span id="Cookies">Cookies</span></li></h4>
								<p id="para1">The session ID exchange mechanism based on cookies provides multiple security features in the form of cookie attributes 
								that can be used to protect the exchange of the session ID: </p>
								<ol type="a">
						<h5><li><span id="Secure_Attribute">Secure Attribute</span></li></h5>
								<p id="para1">The "Secure" cookie attribute instructs web browsers to only send the cookie through an encrypted HTTPS (SSL/TLS) 
								connection. This session protection mechanism is mandatory to prevent the disclosure of the session ID through MitM 
								(Man-in-the-Middle) attacks. It ensures that an attacker cannot simply capture the session ID from web browser traffic. </p>
								<p id="para1">Forcing the web application to only use HTTPS for its communication (even when port TCP/80, HTTP, is closed in the web 
								application host) does not protect against session ID disclosure if the "Secure" cookie has not been set - the web browser 
								can be deceived to disclose the session ID over an unencrypted HTTP connection. The attacker can intercept and manipulate the 
								victim user traffic and inject an HTTP unencrypted reference to the web application that will force the web browser to submit 
								the session ID in the clear. </p>
							
							<h5><li><span id="HttpOnly_Attribute">HttpOnly Attribute</span></li></h5>
								<p id="para1">The "HttpOnly" cookie attribute instructs web browsers not to allow scripts (e.g. JavaScript or VBscript) an ability to 
								access the cookies via the DOM document.cookie object. This session ID protection is mandatory to prevent session ID stealing 
								through XSS attacks. </p>
								<p id="para1">See the OWASP XSS Prevention Cheat Sheet: </p>
								<a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet');">
								<p  style="text-align:left;">	
									<u>https://www.owasp.org/ index.php/ XSS_( Cross_Site_Scripting )_Prevention_Cheat_Sheet.
								</u></p></a> 
								
							
							<h5><li><span id="Domain_and_Path_Attributes">Domain and Path Attributes</span></li></h5>
								<p id="para1">The "Domain" cookie attribute instructs web browsers to only send the cookie to the specified domain and all subdomains. 
								If the attribute is not set, by default the cookie will only be sent to the origin server. The "Path" cookie attribute 
								instructs web browsers to only send the cookie to the specified directory or subdirectories (or paths or resources) within 
								the web application. If the attribute is not set, by default the cookie will only be sent for the directory (or path) of the 
								resource requested and setting the cookie. </p>
								<p id="para1">It is recommended to use a narrow or restricted scope for these two attributes. In this way, the "Domain" attribute should 
								not be set (restricting the cookie just to the origin server) and the "Path" attribute should be set as restrictive as 
								possible to the web application path that makes use of the session ID. </p>
								<p id="para1">Setting the "Domain" attribute to a too permissive value, such as "example.com" allows an attacker to launch attacks on 
								the session IDs between different hosts and web applications belonging to the same domain, known as cross-subdomain cookies. 
								For example, vulnerabilities in www.example.com might allow an attacker to get access to the session IDs from 
								secure.example.com. </p>
								<p id="para1">Additionally, it is recommended not to mix web applications of different security levels on the same domain. 
								Vulnerabilities in one of the web applications would allow an attacker to set the session ID for a different web application 
								on the same domain by using a permissive "Domain" attribute (such as "example.com") which is a technique that can be used in 
								session fixation attacks [4]. </p>
								<p id="para1">Although the 'Path' attribute allows the isolation of session IDs between different web applications using different paths 
								on the same host, it is highly recommended not to run different web applications (especially from different security levels 
								or scopes) on the same host. Other methods can be used by these applications to access the session IDs, such as the 
								"document.cookie" object. Also, any web application can set cookies for any path on that host. </p>
								<p id="para1">Cookies are vulnerable to DNS spoofing/hijacking/poisoning attacks, where an attacker can manipulate the DNS resolution to 
								force the web browser to disclose the session ID for a given host or domain. </p>
							
							<h5><li><span id="Expire_and_Max-Age_Attributes">Expire and Max-Age Attributes</span></li></h5>
								<p id="para1">Session management mechanisms based on cookies can make use of two types of cookies, non-persistent (or session) cookies, 
								and persistent cookies. If a cookie presents the "Max-Age" (that has preference over "Expires") or "Expires" attributes, it 
								will be considered a persistent cookie and will be stored on disk by the web browser based until the expiration time. 
								Typically, session management capabilities to track users after authentication make use of non-persistent cookies. This 
								forces the session to disappear from the client if the current web browser instance is closed. Therefore, it is highly 
								recommended to use non-persistent cookies for session management purposes, so that the session ID does not remain on the web 
								client cache for long periods of time, from where an attacker can obtain it. </p>
								
								</ol>
						<h4><li><span class="mw-headline" id="Manual_Session_Expiration">Manual Session Expiration</span></li></h4>
							<p id="para1">Web applications should provide mechanisms that allow security aware users to actively close their session once they have 
								finished using the web application. </p>
							<h5><span class="mw-headline" id="Logout_Button">Logout Button</span></h5>
							<p id="para1">Web applications must provide a visible an easily accessible logout (logoff, exit, or close session) button that is available 
								on the web application header or menu and reachable from every web application resource and page, so that the user can manually 
								close the session at any time.</p>
							<p id="para1">
							<b>NOTE</b>: Unfortunately, not all web applications facilitate users to close their current session. Thus, client-side 
								enhancements such as the PopUp LogOut Firefox add-on [9] allow conscientious users to protect their sessions by helping to close 
								them diligently.
							</p>
				
						<h4><li><span id="Automatic_Session_Expiration">Automatic Session Expiration</span></li></h4>
							<ol type="a">
							<h5><li><span id="Idle_Timeout">Idle Timeout</span></li></h5>
								<p id="para1">All sessions should implement an idle or inactivity timeout. This timeout defines the amount of time a session will remain active 
										in case there is no activity in the session, closing and invalidating the session upon the defined idle period since the last HTTP 
										request received by the web application for a given session ID. </p>
								<p id="para1">The idle timeout limits the chances an attacker has to guess and use a valid session ID from another user. However, if the 
										attacker is able to hijack a given session, the idle timeout does not limit the attacker's actions, as he can generate activity on 
										the session periodically to keep the session active for longer periods of time. </p>
								<p id="para1">Session timeout management and expiration must be enforced server-side. If the client is used to enforce the session timeout, for 
										example using the session token or other client parameters to track time references (e.g. number of minutes since login time), an 
										attacker could manipulate these to extend the session duration. </p>
								
							<h5><li><span id="Absolute_Timeout">Absolute Timeout</span></li></h5>
								<p id="para1">All sessions should implement an absolute timeout, regardless of session activity. This timeout defines the maximum amount of time 
										a session can be active, closing and invalidating the session upon the defined absolute period since the given session was initially 
										created by the web application. After invalidating the session, the user is forced to (re)authenticate again in the web application 
										and establish a new session. </p>
								<p id="para1">The absolute session limits the amount of time an attacker can use a hijacked session and impersonate the victim user. </p>
							</ol>
						<h4><li><span  id="Force_Session_Logout_On_Web_Browser_Window_Close_Events">Force Session Logout On Web Browser Window Close Events</span></li></h4>
								<p id="para1">Web applications can use JavaScript code to capture all the web browser tab or window close (or even back) events and take the 
										appropriate actions to close the current session before closing the web browser, emulating that the user has manually closed the 
										session via the logout button. </p>
				
						<h4><li><span id="Session_Attacks_Detection">Session Attacks Detection</span></li></h4>
						<ol type="a">
							<h5><li><span id="Session_ID_Guessing_and_Brute_Force_Detection">Session ID Guessing and Brute Force Detection</span></li></h4>
								<p id="para1">If an attacker tries to guess or brute force a valid session ID, he needs to launch multiple sequential requests against the 
										target web application using different session IDs from a single (or set of) IP address(es). Additionally, if an attacker tries to 
										analyze the predictability of the session ID (e.g. using statistical analysis), he needs to launch multiple sequential requests from 
										a single (or set of) IP address(es) against the target web application to gather new valid session IDs. </p>
								<p id="para1">Web applications must be able to detect both scenarios based on the number of attempts to gather (or use) different session IDs 
										and alert and/or block the offending IP address(es). 
								</p>
							<h5><li><span id="Detecting_Session_ID_Anomalies">Detecting Session ID Anomalies</span></li></h5>
								<p id="para1">Web applications should focus on detecting anomalies associated to the session ID, such as its manipulation. The OWASP AppSensor 
										Project [7] provides a framework and methodology to implement built-in intrusion detection capabilities within web applications 
										focused on the detection of anomalies and unexpected behaviors, in the form of detection points and response actions. Instead of 
										using external protection layers, sometimes the business logic details and advanced intelligence are only available from inside the 
										web application, where it is possible to establish multiple session related detection points, such as when an existing cookie is 
										modified or deleted, a new cookie is added, the session ID from another user is reused, or when the user location or User-Agent 
										changes in the middle of a session. 
								</p>
							<h5><li><span id="Binding_the_Session_ID_to_Other_User_Properties">Binding the Session ID to Other User Properties</span></li></h5>
								<p id="para1">With the goal of detecting (and, in some scenarios, protecting against) user misbehaviors and session hijacking, it is highly 
										recommended to bind the session ID to other user or client properties, such as the client IP address, User-Agent, or client-based 
										digital certificate. If the web application detects any change or anomaly between these different properties in the middle of an 
										established session, this is a very good indicator of session manipulation and hijacking attempts, and this simple fact can be used 
										to alert and/or terminate the suspicious session. 
																</p>
										<p id="para1">Although these properties cannot be used by web applications to trustingly defend against session attacks, they significantly 
										increase the web application detection (and protection) capabilities. However, a skilled attacker can bypass these controls by 
										reusing the same IP address assigned to the victim user by sharing the same network (very common in NAT environments, like Wi-Fi 
										hotspots) or by using the same outbound web proxy (very common in corporate environments), or by manually modifying his User-Agent to 
										look exactly as the victim users does. 
								</p>
							<h5><li><span id="Logging_Sessions_Life_Cycle:_Monitoring_Creation.2C_Usage.2C_and_Destruction_of_Session_IDs">Logging Sessions Life 
										Cycle: Monitoring Creation, Usage, and Destruction of Session IDs</span></li></h5>
								<p id="para1">Web applications should increase their logging capabilities by including information regarding the full life cycle of sessions. In 
										particular, it is recommended to record session related events, such as the creation, renewal, and destruction of session IDs, as 
										well as details about its usage within login and logout operations, privilege level changes within the session, timeout expiration, 
										invalid session activities (when detected), and critical business operations during the session. 
								</p>
								<p id="para1">The log details might include a timestamp, source IP address, web target resource requested (and involved in a session 
										operation), HTTP headers (including the User-Agent and Referer), GET and POST parameters, error codes and messages, username (or user 
										ID), plus the session ID (cookies, URL, GET, POSTâ€¦). Sensitive data like the session ID should not be included in the logs in order 
										to protect the session logs against session ID local or remote disclosure or unauthorized access. However, some kind of 
										session-specific information must be logged into order to correlate log entries to specific sessions. It is recommended to log a 
										salted-hash of the session ID instead of the session ID itself in order to allow for session-specific log correlation without 
										exposing the session ID.
								</p>
								<p id="para1">In particular, web applications must thoroughly protect administrative interfaces that allow to manage all the current active 
										sessions. Frequently these are used by support personnel to solve session related issues, or even general issues, by impersonating 
										the user and looking at the web application as the user does.
								</p><p id="para1">The session logs become one of the main web application intrusion detection data sources, and can also be used by intrusion 
										protection systems to automatically terminate sessions and/or disable user accounts when (one or many) attacks are detected. If 
										active protections are implemented, these defensive actions must be logged too.
								</p>
							<h5><li><span id="Simultaneous_Session_Logons">Simultaneous Session Logons</span></li></h5>
								<p id="para1">It is the web application design decision to determine if multiple simultaneous logons from the same user are allowed from the 
										same or from different client IP addresses. If the web application does not want to allow simultaneous session logons, it must take 
										effective actions after each new authentication event, implicitly terminating the previously available session, or asking the user 
										(through the old, new or both sessions) about the session that must remain active. 
							</p><p id="para1">It is recommended for web applications to add user capabilities that allow checking the details of active sessions at any 
										time, monitor and alert the user about concurrent logons, provide user features to remotely terminate sessions manually, and track 
										account activity history (logbook) by recording multiple client details such as IP address, User-Agent, login date and time, idle 
										time, etc. 
								</p>
								</ol>
					<h4><li><span id="Session_Management_WAF_Protections">Session Management WAF Protections</span></li></h4>
								<p id="para1">There are situations where the web application source code is not available or cannot be modified, or when the changes required to 
									implement the multiple security recommendations and best practices detailed above imply a full redesign of the web application 
									architecture, and therefore, cannot be easily implemented in the short term. In these scenarios, or to complement the web application 
									defenses, and with the goal of keeping the web application as secure as possible, it is recommended to use external protections such 
									as Web Application Firewalls (WAFs) that can mitigate the session management threats already described. 
								</p>
								<p id="para1">Web Application Firewalls offer detection and protection capabilities against session based attacks. On the one hand, it is 
									trivial for WAFs to enforce the usage of security attributes on cookies, such as the "Secure" and "HttpOnly" flags, applying basic 
									rewriting rules on the "Set-Cookie" header for all the web application responses that set a new cookie. On the other hand, more 
									advanced capabilities can be implemented to allow the WAF to keep track of sessions, and the corresponding session IDs, and apply all 
									kind of protections against session fixation (by renewing the session ID on the client-side when privilege changes are detected), 
									enforcing sticky sessions (by verifying the relationship between the session ID and other client properties, like the IP address or 
									User-Agent), or managing session expiration (by forcing both the client and the web application to finalize the session). 
								</p><p id="para1">The open-source ModSecurity WAF, plus the OWASP Core Rule Set [6], provide capabilities to detect and apply security cookie 
									attributes, countermeasures against session fixation attacks, and session tracking features to enforce sticky sessions. 
						</p>	
				</ol>						
				</td>
			</tr>
			<tr id="details3" onClick="toggle3();">
				<td id="cheatsheet-table-row">		 
				  <a href="#one" id="cheatsheet-table-data">				
					<div  id="option-skyblue">
						<h1 id="option-header">3.</h1>
					</div>		
					<div id="option-header-layout">
						<strong id="option-header-label">Access Control</strong>
					</div>
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>
					</a>
					<div class="decoration_blank" id="three"></div>
				</td>
			</tr>			
					<tr id="row3">
				<td class="container" id="row-details">
			<ol type="A">
				<h4><li><span>Role Based Access Control (RBAC)</span></li></h4>
						<p>In Role-Based Access Control (RBAC), access decisions are based on an individual's roles and responsibilities within the 
							organization or user base. The process of defining roles is usually based on analyzing the fundamental goals and structure of an 
							organization and is usually linked to the security policy. For instance, in a medical organization, the different roles of users may 
							include those such as doctor, nurse, attendant, nurse, patients, etc. Obviously, these members require different levels of access in 
							order to perform their functions, but also the types of web transactions and their allowed context vary greatly depending on the 
							security policy and any relevant regulations (HIPAA, Gramm-Leach-Bliley, etc.). 
						</p>
						<p>An RBAC access control framework should provide web application security administrators with the ability to determine who can 
							perform what actions, when, from where, in what order, and in some cases under what relational circumstances. <a id="hyperlink" href="javascript:loadURL('http://csrc.nist.gov/rbac/');">http://csrc.nist.gov/rbac/</a> provides some great resources for RBAC 
							implementation. The following aspects exhibit RBAC attributes to an access control model.
						</p>
						<ul type="square">
						<li>Roles are assigned based on organizational structure with emphasis on the organizational security policy
						</li>
						<li>Roles are assigned by the administrator based on relative relationships within the organization or user base. For instance, a 
							manager would have certain authorized transactions over his employees. An administrator would have certain authorized transactions 
							over his specific realm of duties (backup, account creation, etc.) 
						</li>
						<li>Each role is designated a profile that includes all authorized commands, transactions, and allowable information access.
						</li>
						<li>Roles are granted permissions based on the principle of least privilege.
						</li>
						<li>Roles are determined with a separation of duties in mind so that a developer Role should not overlap a QA tester Role.
						</li>
						<li>Roles are activated statically and dynamically as appropriate to certain relational triggers (help desk queue, security alert, 
							initiation of a new project, etc.) 
						</li>
						<li>Roles can be only be transferred or delegated using strict sign-offs and procedures.
						</li>
						<li>Roles are managed centrally by a security administrator or project leader
						</li>
						</ul>
						<p>OWASP has a role based access control implementation project, <a id="hyperlink" href="javascript:loadURL('https:/www.owasp.org/index.php/OWASP_PHPRBAC_Project'); title="OWASP PHPRBAC 
							Project">OWASP RBAC Project</a>.
						</p>
			
			
					<h4><li><span id="Testing_for_Broken_Access_Control">Testing for Broken Access Control</span></li></h4>
						<ul  type="square">
						<li>Attempt to access administrative components or functions as an anonymous or regular user
							<ul  type="circle">
								<li>Scour HTML source for "interesting" hidden form fields
								</li>
								<li>Test web accessible directory structure for names like admin, administrator, manager, etc (i.e. attempt to directly browse to 
								"restricted" areas)
								</li>
							</ul>
						</li>
						<li>Determine how administrators are authenticated. Ensure that adequate authentication is used and enforced
						</li>
						<li>For each user role, ensure that only the appropriate pages or components are accessible for that role.
						</li>
						<li>Login as a low-level user, browse history for a higher level user's cache, load the page to see if the original authorization is 
							passed to a previous session.
						</li>
						<li>If able to compromise administrator-level account, test for all other common web application vulnerabilities (poor input 
							validation, privileged database access, etc)
						</li>
						</ul>
			
				<h4><li><span id="Access_Control_Anti-Patterns">Access Control Anti-Patterns</span></li></h1>
						<ul  type="square">
						<li>Hard-coded role checks in application code
						</li>
						<li>Lack of centralized access control logic
						</li>
						<li>Untrusted data driving access control decisions
						</li>
						<li>Access control that is "open by default"
						</li>
						<li>Lack of addressing horizontal access control in a standardized way (if at all)
						</li>
						<li>Access control logic that needs to be manually added to every endpoint in code
						</li>
						<li>non-anonymous entry point DO NOT have an access control check
						</li>
						<li>No authorization check at or near the beginning of code implementing sensitive activities
						</li>
						</ul>
						<ol type="a">
								<h5><li><span class="mw-headline" id="Hard_Coded_Roles">Hard Coded Roles</span></li></h5>
									<p> if (user.isManager() ||<br>
										 user.isAdministrator() ||<br>
										 user.isEditor() ||<br>
										 user.isUser()) {<br>
										 //execute action<br>
									 }<br>
									</p>
									<p><b>Hard Codes Roles can create several issues including:</b>
									</p>
									<ul>
									<li>Making the policy of an application difficult to "prove" for audit or Q/A purposes 
									</li>
									<li>Causing new code to be pushed each time an access control policy needs to be changed. 
									</li>
									<li>They are fragile and easy to make mistakes
									</li>
									</ul>
								<h5><li><span class="mw-headline" id="Order_Specific_Operations">Order Specific Operations</span></li></h5>
									<p>Imagine the following parameters
									</p>
									<p> <a rel="nofollow" id="hyperlink" href="javascript:loadURL('http://example.com/buy?action=chooseDataPackage');">
										http://example.com/buy?action=chooseDataPackage</a>
									 <a rel="nofollow" id="hyperlink" href="javascript:loadURL('http://example.com/buy?action=customizePackage');">http://example.com/buy?action=customizePackage
									</a>
									 <a rel="nofollow" id="hyperlink" href="javascript:loadURL('http://example.com/buy?action=makePayment');">http://example.com/buy?action=makePayment</a>
									 <a rel="nofollow" id="hyperlink" href="javascript:loadURL('http://example.com/buy?action=downloadData');">http://example.com/buy?action=downloadData</a>
									</p>
									<p><b>Can an attacker control the sequence?</b>
									</p><p><b>Can an attacker abuse this with concurrency?</b>
									</p>
								<h5><li><span class="mw-headline" id="Never_Depend_on_Untrusted_Data">Never Depend on Untrusted Data</span></li></h5>
									<ul>
									<li>Never trust user data for access control decisions
									</li>
									<li>Never make access control decisions in JavaScript
									</li>
									<li>Never depend on the order of values sent from the client
									</li>
									<li>Never make authorization decisions based solely on
									<ul type="circle">
										<li>hidden fields
										</li>
										<li>cookie values
										</li>
										<li>form parameters
										</li>
										<li>URL parameters
										</li>
										<li>anything else from the request
										</li>
									</ul>
									</li>
									</ul>			
						</ol>
			</ol>
				</td>
			</tr>
			<tr id="details4" onClick="toggle4();">
				<td id="cheatsheet-table-row">		
				   <a href="#two" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">4.</h1>
					</div>
					<div id="option-header-layout">					
						<strong id="option-header-label">Input Validation</strong>	
					</div>					
					<i class="fa fa-angle-down"  id="option-header-label-arrow"></i>	
				  </a>
				  <div class="decoration_blank" id="four"></div>
				</td>
			</tr>	
						<tr id="row4">
							<td class="container" id="row-details">
							<ol type="A">
							<h5><li><span class="mw-headline" id="Goal_of_Input_Validation">Goal of Input Validation</span></li></h5>
							<p>Input validation is performed to minimize malformed data from entering the system. Input Validation is NOT the primary method 
								of preventing XSS, SQL Injection. These are covered in output encoding below. 
							</p><p>Input Validation Must Be:
							</p>
							<ul  type="square">
							<li> Applied to all user controlled data
							</li>
							<li> Define the types of characters that can be accepted (often U+0020 to U+007E, though most special characters could be removed 
								and control characters are almost never needed)
							</li>
							<li> Defines a minimum and maximum length for the data (e.g. {1,25} ) 
							</li>
							</ul>
							<h5><li><span class="mw-headline" id="Client_Side_vs_Server_Side_Validation">Client Side vs Server Side Validation</span></li></h5>
							<p>Be aware that any JavaScript input validation performed on the client can be bypassed by an attacker that disables JavaScript 
								or uses a Web Proxy. Ensure that any input validation performed on the client is also performed on the server.
							</p>
							<h5><li><span class="mw-headline" id="Positive_Approach">Positive Approach</span></li></h5>
							<p>The variations of attacks are enormous. Use regular expressions to define what is good and then deny the input if anything 
								else is received. In other words, we want to use the approach "Accept Known Good" instead of "Reject Known Bad"
							</p>
							<p>Example A field accepts a username. A good regex would be to verify 
							that the data consists of the following [0-9a-zA-Z]{3,10}. The data 
							is rejected if it doesn't match.  
							</p>
							<p>A bad approach would be to build a list of malicious strings and then 
							just verify that the username does not contain the bad string. This 
							approach begs the question, did you think of all possible bad strings?
							</p>
							<h5><li><span>Robust Use of Input Validation</span></li></h5>
							<p>All data received from the user should be treated as malicious and verified before using within the application. This includes 
								the following
							</p>
							<ul  type="square">
							<li> Form data
							</li>
							<li> URL parameters
							</li>
							<li> Hidden fields
							</li>
							<li> Cookie data
							</li>
							<li> HTTP Headers
							</li>
							<li> Essentially anything in the HTTP request 
							</li>
							</ul>
							<h5><li><span>Input Validation</span></li></h5>
							<p>Data recieved from the user should be validated for the following factors as well:
							</p>
							<ol>
								<li>Boundary conditions (Out of range values)</li>
								<li>Length of the data inputed (for example, if the input control can accept only 8 character, the same should be validated while 
									accepting the data. The input chars should not exceed 8 characters).
								</li>
							</ol>
							<h5><li><span>Validating Rich User Content</span></li></h5>
							<p>It is very difficult to validate rich content submitted by a user. Consider more formal approaches such as 
							<a id="hyperlink" href="javascript:loadURL('http://htmlpurifier.org/');">HTML Purifier (PHP)</a>, 
							<a id="hyperlink" href="javascript:loadURL('http://www.owasp.org/index.php/Category:OWASP_AntiSamy_Project');">AntiSamy</a> or 
							<a id="hyperlink" href="javascript:loadURL('https:/www.owasp.orghttp://github.com/jsocol/bleach/');">bleach (Python)</a>
							</p>
							<h5><li><span>File Upload</span></li></h5>		
							</ol>							
							</td>
						</tr>		
			<tr id="details5" onClick="toggle5();">
				<td id="cheatsheet-table-row">		
				  <a href="#three" class="option-header-link" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">5.</h1>
					</div>		
					<div id="option-header-layout">					
						<strong id="option-header-label">Output Encoding</strong>						
					</div>					
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>
				  </a>
				  <div class="decoration_blank" id="five"></div>
				</td>
			</tr>	
						<tr id="row5">
							<td class="container" id="row-details">
						
							<ol type="A">
						<h5><li><span>Preventing XSS and Content Security Policy</span></li></h5>
							<ul  type="square">
							<li> All user data controlled must be encoded when returned in the html page to prevent the execution of malicious data (e.g. 
							XSS). For example &lt;script&gt; would be returned as &amp;lt;script&amp;gt;
							</li>
							<li> The type of encoding is specific to the context of the page where the user controlled data is inserted. For example, HTML 
							entity encoding is appropriate for data placed into the HTML body. However, user data placed into a script would need JavaScript 
							specific output encoding 
							</li>
							</ul>
							<p>Detailed information on XSS prevention here: OWASP XSS Prevention Cheat Sheet
							</p>
						<h5><li><span>Preventing SQL Injection</span></li></h5>
							<ul  type="square">
							<li> It's not realistic to always know if a piece of data is user controlled, therefore parameterized queries should be used 
							whenever a method/function accepts data and uses this data as part of the SQL statement. 
							</li>
							<li> String concatenation to build any part of a SQL statement with user controlled data creates a SQL injection vulnerability.
							</li>
							<li> Parameterized queries are a guaranteed approach to prevent SQL injection.
							</li>
							</ul>
							<p>Further Reading: SQL Injection Prevention Cheat Sheet
							</p>
						<h5><li><span>Preventing OS Injection</span></li></h5>
							<ul  type="square">
							<li> Avoid sending user controlled data to the OS as much as possible
							</li>
							<li> Ensure that a robust escaping routine is in place to prevent the user from adding additional characters that can be executed 
								by the OS ( e.g. user appends | to the malicious data and then executes another OS command). Remember to use a positive approach 
								when constructing escaping routinges. Example 
							</li>
							</ul>
							<p>Further Reading: Reviewing Code for OS Injection
							</p>
						<h5><li><span>Preventing XML Injection</span></li></h5>
							<ul  type="square">
							<li> In addition to the existing input validation, define a positive approach which escapes/encodes characters that can be 
								interpreted as xml. At a minimum this includes the following: &lt; &gt; " ' &amp; 
							</li>
							<li> If accepting raw XML then more robust validation is necessary. This can be complex. Please contact the infrastructure 
								security team for additional discussion 
							</li>
							</ul>	
</ol>							
							</td>
						</tr>				
			<tr id="details6" onClick="toggle6();">
				<td id="cheatsheet-table-row">		
				  <a href="#four" class="option-header-link" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">6.</h1>
					</div>		
					<div id="option-header-layout">					
						<strong id="option-header-label">File Uploads</strong>						
					</div>					
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>
				  </a>
				  <div class="decoration_blank" id="six"></div>
				</td>
			</tr>	
						<tr id="row6">
							<td class="container" id="row-details">
							<ol  type="A">
							<h5><li><span>Upload Verification</span></li></h5>
								<ul  type="square">
									<li>Use input validation to ensure the uploaded filename uses an expected extension type 
									</li>
									<li>Ensure the uploaded file is not larger than a defined maximum file size
									</li>
								</ul>
								<h5><li><span>Upload Storage</span></li></h5>
								<ul  type="square">
									<li>Use a new filename to store the file on the OS. Do not use any user controlled text for this filename or for the temporary 
										filename. 
									</li>
									<li>Store all user uploaded files on a separate domain (e.g. mozillafiles.net vs mozilla.org). Archives should be analyzed for 
										malicious content (anti-malware, static analysis, etc)
									</li>
								</ul>
							<h5><li><span>Public Serving of Uploaded Content</span></li></h5>
								<ul  type="square">
									<li>Ensure the image is served with the correct content-type (e.g. image/jpeg, application/x-xpinstall)
									</li>
								</ul>
							<h5><li><span>Beware of "special" files</span></li></h5>
								<ul  type="square">
								<li> The upload feature should be using a whitelist approach to only allow specific file types and extensions. However, it is 
									important to be aware of the following file types that, if allowed, could result in security vulnerabilities.
								</li>
								<li>"crossdomain.xml" allows cross-domain data loading in Flash, Java and Silverlight.  If permitted on sites with authentication 
									this can permit cross-domain data theft and CSRF attacks.  Note this can get pretty complicated depending on the specific plugin 
									version in question, so its best to just prohibit files named "crossdomain.xml" or "clientaccesspolicy.xml".
								</li>
								<li>".htaccess" and ".htpasswd" provides server configuration options on a per-directory basis, and should not be permitted.  See 
									<u>http:// en.wikipedia.org /wiki /Htaccess</u>
								</li>
								</ul>							
							<h5><li><span>Upload Verification</span></li></h5>
								<ul  type="square">
									<li>Use image rewriting libraries to verify the image is valid and to strip away extraneous content. 
									</li>
									<li>Set the extension of the stored image to be a valid image extension based on the detected content type of the image from 
										image processing (e.g. do not just trust the header from the upload). 
									</li>
									<li>Ensure the detected content type of the image is within a list of defined image types (jpg, png, etc)
									</li>
								</ul>						
							</ol>
							</td>
						</tr>				
			<tr id="details7" onClick="toggle7();">
				<td id="cheatsheet-table-row">		
				  <a href="#five" class="option-header-link" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">7.</h1>
					</div>		
					<div id="option-header-layout">					
						<strong id="option-header-label">XSS</strong>						
					</div>					
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>
				  </a>
				  <div class="decoration_blank" id="sevan"></div>
				</td>
			</tr>	
						<tr id="row7">
							<td class="container" id="row-details">
							
						    <p>This article provides a simple positive model for preventing XSS using output escaping/encoding properly. While there are a 
								huge number of XSS attack vectors, following a few simple rules can completely defend against this serious attack. This article 
								does not explore the technical or business impact of XSS. Suffice it to say that it can lead to an attacker gaining the ability 
								to do anything a victim can do through their browser.
							</p>
							<p>Both reflected and stored XSS can be addressed by performing the appropriate validation and escaping on the server-side. DOM 
								Based XSS can be addressed with a special subset of rules described in the DOM based XSS Prevention Cheat Sheet.
							</p>
							<p>For a cheatsheet on the attack vectors related to XSS, please refer to the XSS Filter Evasion Cheat Sheet. More background on 
								browser security and the various browsers can be found in the Browser Security Handbook.
							</p>
							<p>Before reading this cheatsheet, it is important to have a fundamental understanding of Injection Theory.
							</p>
						<h5><span>A Positive XSS Prevention Model</span></h5>
							<p>This article treats an HTML page like a template, with slots where a developer is allowed to put untrusted data. These slots 
								cover the vast majority of the common places where a developer might want to put untrusted data. Putting untrusted data in other 
								places in the HTML is not allowed. This is a "whitelist" model, that denies everything that is not specifically allowed.
							</p>
							<p>Given the way browsers parse HTML, each of the different types of slots has slightly different security rules. When you put 
								untrusted data into these slots, you need to take certain steps to make sure that the data does not break out of that slot into a 
								context that allows code execution. In a way, this approach treats an HTML document like a parameterized database query - the 
								data is kept in specific places and is isolated from code contexts with escaping.
							</p>
							<p>This document sets out the most common types of slots and the rules for putting untrusted data into them safely. Based on the 
								various specifications, known XSS vectors, and a great deal of manual testing with all the popular browsers, we have determined 
								that the rule proposed here are safe.
							</p>
							<p>The slots are defined and a few examples of each are provided. Developers SHOULD NOT put data into any other slots without a 
								very careful analysis to ensure that what they are doing is safe. Browser parsing is extremely tricky and many innocuous looking 
								characters can be significant in the right context.
							</p>
						<h5><span>Why Can't I Just HTML Entity Encode Untrusted Data?</span></h5>
							<p>HTML entity encoding is okay for untrusted data that you put in the body of the HTML document, such as inside a &lt;div&gt; 
								tag.  It even sort of works for untrusted data that goes into attributes, particularly if you're religious about using quotes 
								around your attributes.  But HTML entity encoding doesn't work if you're putting untrusted data inside a &lt;script&gt; tag 
								anywhere, or an event handler attribute like onmouseover, or inside CSS, or in a URL.  So even if you use an HTML entity encoding 
								method everywhere, you are still most likely vulnerable to XSS.  <b>You MUST use the escape syntax for the part of the HTML 
								document you're putting untrusted data into.</b>  That's what the rules below are all about.
							</p>
						<h5><span>You Need a Security Encoding Library</span></h5>
							<p>Writing these encoders is not tremendously difficult, but there are quite a few hidden pitfalls. For example, you might be 
								tempted to use some of the escaping shortcuts like \" in JavaScript. However, these values are dangerous and may be 
								misinterpreted by the nested parsers in the browser. You might also forget to escape the escape character, which attackers can 
								use to neutralize your attempts to be safe. OWASP recommends using a security-focused encoding library to make sure these rules 
								are properly implemented.
							</p><p>Microsoft provides an encoding library named the Microsoft Anti-Cross Site Scripting Library for the .NET platform and 
								ASP.NET Framework has built-in ValidateRequest function that provides <b>limited</b> sanitization.
							</p><p>The OWASP ESAPI project has created an escaping library for Java. OWASP also provides the OWASP Java Encoder Project for 
								high-performance encoding.
							</p>
						<ol start="1">
							<h4><li><span>XSS Prevention Rules</span></li></h4>
							<p>The following rules are intended to prevent all XSS in your application. While these rules do not allow absolute freedom 
									in putting untrusted data into an HTML document, they should cover the vast majority of common use cases. You do not have to 
									allow <b>all</b> the rules in your organization. Many organizations may find that <b>allowing only Rule #1 and Rule #2 are 
									sufficient for their needs</b>. Please add a note to the discussion page if there is an additional context that is often 
									required and can be secured with escaping.
								</p><p>Do NOT simply escape the list of example characters provided in the various rules. It is NOT sufficient to escape only 
										that list. Blacklist approaches are quite fragile.  The whitelist rules here have been carefully designed to provide 
										protection even against future vulnerabilities introduced by browser changes.
								</p>
							<ul type="square">
								<h5><li><span>RULE #0 - Never Insert Untrusted Data Except in Allowed Locations</span></li></h5>
								
							<p>The first rule is to <b>deny all</b> - don't put untrusted data into your HTML document unless it is within one of the slots 
								defined in Rule #1 through Rule #5. The reason for Rule #0 is that there are so many strange contexts within HTML that the list 
								of escaping rules gets very complicated. We can't think of any good reason to put untrusted data in these contexts. This includes 
								"nested contexts" like a URL inside a javascript -- the encoding rules for those locations are tricky and dangerous.  If you 
								insist on putting untrusted data into nested contexts, please do a lot of cross-browser testing and let us know what you find out.
							</p>
							<div style="border: 2px dashed #444444; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; padding: 4px; 
							margin-left: +20px; margin-right: +20px;">
							<p id="code-tag" style="font-size:70%">
								 &lt;script&gt;<b> ...NEVER PUT UNTRUSTED DATA HERE... </b>&lt;/script&gt;   directly in a script<br>
							 
								 &lt;!--<b> ...NEVER PUT UNTRUSTED DATA HERE... </b>--&gt;             inside an HTML comment<br>							 
								 &lt;div <b> ...NEVER PUT UNTRUSTED DATA HERE... </b>=test /&gt;       in an attribute name<br>							 
								 &lt;<b> NEVER PUT UNTRUSTED DATA HERE... </b>href="/test" /&gt;   in a tag name<br>							 
								 &lt;style&gt;<b> ...NEVER PUT UNTRUSTED DATA HERE... </b>&lt;/style&gt;   directly in CSS<br>
								</p>
							</div>
							<p>Most importantly, never accept actual JavaScript code from an untrusted source and then run it. For example, a parameter named 
								"callback" that contains a JavaScript code snippet.  No amount of escaping can fix that.
							</p>
								<h5><li><span>RULE #1 - HTML Escape Before Inserting Untrusted Data into HTML Element Content</span></li></h5>
									<p>Rule #1 is for when you want to put untrusted data directly into the HTML body somewhere. This includes inside normal tags 
								like div, p, b, td, etc. Most web frameworks have a method for HTML escaping for the characters detailed below. However, this is 
								<b>absolutely not sufficient for other HTML contexts.</b>  You need to implement the other rules detailed here as well.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
							padding: 4px;margin-left: +20px; margin-right: +20px;">
								 <p id="code-tag" style="font-size:70%">
								 &lt;body&gt;<b> ...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...</b> &lt;/body&gt;<br>							 
								 &lt;div&gt;<b> ...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...</b> &lt;/div&gt;<br>							 
								 any other normal HTML elements<br>
								</p>
							</div>
							<p>Escape the following characters with HTML entity encoding to prevent switching into any execution context, such as script, 
								style, or event handlers. Using hex entities is recommended in the spec. In addition to the 5 characters significant in XML (&amp;
								, &lt;, &gt;, ", '), the forward slash is included as it helps to end an HTML entity.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
								&amp; --&gt; &amp;amp;<br>
								 &lt; --&gt; &amp;lt;<br>
								 &gt; --&gt; &amp;gt;<br>
								 " --&gt; &amp;quot;<br>
								 ' --&gt; &amp;#x27;     &amp;apos; not recommended <br>because its not in the HTML spec &amp;apos; <br>is in the XML and 
									XHTML specs.<br>
								 / -</p>
							</div>
							<p>See the ESAPI reference implementation of HTML entity escaping and unescaping.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
							padding: 4px;margin-left: +20px; margin-right: +20px;"><p id="code-tag" style="font-size:70%">
							 String safe = ESAPI.encoder( ).encodeForHTML( request.getParameter( "input" ) );	</p>						
							</div>
							
							
								<h5><li><span>RULE #2 - Attribute Escape Before Inserting Untrusted Data into HTML Common Attributes</span></li></h5>
								
									<p>Rule #2 is for putting untrusted data into typical attribute values like width, name, value, etc. This should not be used for 
								complex attributes like href, src, style, or any of the event handlers like onmouseover.  It is extremely important that event 
								handler attributes should follow Rule #3 for HTML JavaScript Data Values.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
								&lt;div attr=<b> ...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...</b> &gt; content&lt;/div&gt;     inside UNquoted attribute
								<br>							 
								 &lt;div attr= '<b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...' </b> &gt; content&lt;/div&gt;   inside single quoted 
									attribute<br>							 
								 &lt;div attr= "<b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...</b>" &gt; content&lt;/div&gt;   inside double quoted 
										attribute<br>
								</p>
							</div>
							<p>Except for alphanumeric characters, escape all characters with ASCII values less than 256 with the &amp;#xHH; format (or a 
								named entity if available) to prevent switching out of the attribute. The reason this rule is so broad is that developers 
								frequently leave attributes unquoted.  Properly quoted attributes can only be escaped with the corresponding quote. Unquoted 
								attributes can be broken out of with many characters, including [space]&#160;% * + , - /&#160;; &lt; = &gt; ^ and |.
							</p><p>See the ESAPI reference implementation of HTML entity escaping and unescaping.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
									padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
								String safe = ESAPI.encoder( ).encodeForHTMLAttribute( request.getParameter( "input" ) );
							</p>
							</div>
							
							
								<h5><li><span>RULE #3 - JavaScript Escape Before Inserting Untrusted Data into JavaScript Data Values</span></li></h5>
											<p>Rule #3 concerns dynamically generated JavaScript code - both script blocks and event-handler attributes. The only safe place 
								to put untrusted data into this code is inside a quoted "data value."  Including untrusted data inside any other JavaScript 
								context is quite dangerous, as it is extremely easy to switch into an execution context with characters including (but not 
								limited to) semi-colon, equals, space, plus, and many more, so use with caution.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
										padding: 4px;margin-left: +20px; margin-right: +20px;">
								 <p id="code-tag" style="font-size:70%">
								 &lt;script&gt;<br>alert( '<b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE... '</b>)<br>&lt;/script&gt;     inside a quoted 
									string<br>							 
								 &lt;script&gt;<br>x= '<b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE... '</b><br>&lt;/script&gt;          one side of a 
									quoted expression<br>							 
								 &lt;div onmouseover= "x='<b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE... '</b>"&lt;/div&gt;  inside quoted event handler
								<br>
								 </p>
							 </div>
							<p>Please note there are some JavaScript functions that can never safely use untrusted data as input - <b>EVEN IF JAVASCRIPT 
									ESCAPED</b>! 
							</p>
							<p>For example:
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
							<p id="code-tag" style="font-size:70%">
							     &lt;script&gt;<br>
								 window.setInterval('<b> ...EVEN IF YOU ESCAPE UNTRUSTED DATA YOU ARE XSSED HERE...'</b>);<br>
								 &lt;/script&gt;<br>
							</p>
							</div>
							<p>Except for alphanumeric characters, escape all characters less than 256 with the \xHH format to prevent switching out of the 
								data value into the script context or into another attribute. DO NOT use any escaping shortcuts like \" because the quote 
								character may be matched by the HTML attribute parser which runs first. These escaping shortcuts are also susceptible to 
								"escape-the-escape" attacks where the attacker sends \" and the vulnerable code turns that into \\" which enables the quote.
							</p>
							<p>If an event handler is properly quoted, breaking out requires the corresponding quote. However, we have intentionally made 
								this rule quite broad because event handler attributes are often left unquoted.  Unquoted attributes can be broken out of with 
								many characters including [space]&#160;% * + , - /&#160;; &lt; = &gt; ^ and |. Also, a &lt;/script&gt; closing tag will close a 
								script block even though it is inside a quoted string because the HTML parser runs before the JavaScript parser.
								</p>
							<p>See the ESAPI reference implementation of JavaScript escaping and unescaping.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
							padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
									String safe = ESAPI.encoder( ).encodeForJavaScript( request.getParameter( "input" ) );
								</p>								
							</div>									
									<ul type="circle">
									<h6><li><span>RULE #3.1 - HTML escape JSON values in an HTML context and read the data with JSON.parse</span></li></h6>
										<p>In a Web 2.0 world, the need for having data dynamically generated by an application in a javascript context is common.  One 
								strategy is to make an AJAX call to get the values, but this isn't always performant.  Often, an initial block of JSON is loaded 
								into the page to act as a single place to store multiple values.  This data is tricky, though not impossible, to escape correctly 
								without breaking the format and content of the values.
							</p>
							<p>
							<b>Ensure returned <i>Content-Type</i> header is application/json and not text/html. </b>
							This shall instruct the browser not misunderstand the context and execute injected script
							</p>
							<p>
							<b>Bad HTTP response:</b>
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
								   HTTP/1.1 200<br>
								   Date: Wed, 06 Feb 2013 10:28:54 GMT<br>
								   Server: Microsoft-IIS/7.5....<br>
								   <b>Content-Type: text/html; charset=utf-8</b> &lt;-- bad<br>
								   ....<br>
								   Content-Length: 373<br>
								   Keep-Alive: timeout=5, max=100<br>
								   Connection: Keep-Alive<br>
								   {"Message":"No HTTP resource was found that matches the request URI 'dev.net.ie/api/pay/ .html?HouseNumber=9 &amp;
									AddressLine<br>
								   =The+Gardens<b> &lt;script&gt;alert(1)&lt;/script&gt;</b> &amp;AddressLine2= foxlodge+woods&amp; TownName=Meath'.", 
									"MessageDetail":"No type was found<br>
								   that matches the controller named 'pay'."}   &lt;-- this script will pop!!							   
								</p>
							</div>
							<p>
							<b>Good HTTP response</b>
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
								   HTTP/1.1 200<br>
								   Date: Wed, 06 Feb 2013 10:28:54 GMT<br>
								   Server: Microsoft-IIS/7.5....<br>
								   <b>Content-Type: application/json; charset=utf-8</b> &lt;--good<br>
								   .....<br>
								   .....<br>
								</p>
							</div>
							<p>A common <b>anti-pattern</b> one would see:
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
							padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
							   &lt;script&gt;<br>
								 var initData = &lt;%= data.to_json&#160;%&gt;; // <b>Do NOT do this without encoding the data with one of the techniques 
								listed below.</b><br>
							   &lt;/script&gt;<br>
							</p>
							</div>										
										<ol>
											<h6><li><span>JSON entity encoding</span></li></h6>
											<p>The rules for JSON encoding can be found in the <a id="hyperlink" href=
												"javascript:loadURL('https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet#Output_Encoding_Rules_Summary');">Output Encoding 
												Rules Summary</a>. Note, this will not allow you to use XSS protection provided by CSP 1.0.
											</p>
											<h6><li><span>HTML entity encoding</span></li></h6>
											<p>This technique has the advantage that html entity escaping is widely supported and helps separate data from server side code 
											without crossing any context boundaries. Consider placing the JSON block on the page as a normal element and then parsing the 
											innerHTML to get the contents.  The javascript that reads the span can live in an external file, thus making the implementation 
											of CSP enforcement easier.
											</p>
											<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
											padding: 4px;margin-left: +20px; margin-right: +20px;">
											<p id="code-tag" style="font-size:70%">
												 &lt;script id="init_data" type="application/json"&gt;<br>
													&lt;%= html_escape( data.to_json )&#160;%&gt;<br>
												 &lt;/script&gt;<br>
												</p>
											</div>
											<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
											padding: 4px;margin-left: +20px; margin-right: +20px;"><p id="code-tag" style="font-size:70%">
											 // external js file<br>
											 var dataElement = document.getElementById( 'init_data' );<br>
											 // unescape the content of the span<br>
											 var jsonText = dataElement.textContent || dataElement.innerText  <br>
											 var initData = JSON.parse( html_unescape(jsonText) );</p>
											</div>
											<p>An alternative to escaping and unescaping JSON directly in JavaScript, is to normalize JSON server-side by converting '&lt;' 
												to '\u003c' before delivering it to the browser.
											</p>
										</ol>
									</ul>
								<h5><li><span>RULE #4 - CSS Escape And Strictly Validate Before Inserting Untrusted Data into HTML Style Property Values </span></li></h5>
								<p>Rule #4 is for when you want to put untrusted data into a stylesheet or a style tag. CSS is surprisingly powerful, and can be 
								used for numerous attacks. Therefore, it's important that you only use untrusted data in a property <b>value</b> and not into 
								other places in style data. You should stay away from putting untrusted data into complex properties like url, behavior, and 
								custom (-moz-binding). You should also not put untrusted data into IEâ€™s expression property value which allows JavaScript.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
							padding: 4px;margin-left: +20px; margin-right: +20px;">
								 <p id="code-tag" style="font-size:70%">
								 &lt;style&gt;selector <br>
								 {<br> 
								 property&#160;: <b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...</b>; 
								 }<br>
								 &lt;/style&gt;     property value<br />
								 &lt;style&gt;selector <br>
								 {<br>
								 property&#160;: &quot;<b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...</b>&quot;; <br>
								 }<br>
								 &lt;/style&gt;   property value<br />
								 &lt;span style=&quot;property&#160;: <b>...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE...</b>&quot;&gt;text&lt;/span&gt;       
								property value
								</p>
							</div>
							<p>Please note there are some CSS contexts that can never safely use untrusted data as input - <b>EVEN IF PROPERLY CSS ESCAPED</b>
								! You will have to ensure that URLs only start with "http" not "javascript" and that properties never start with "expression".
							</p><p>For example:
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
									padding: 4px;margin-left: +20px; margin-right: +20px;">
							 <p id="code-tag" style="font-size:70%">
							 {<br>
								background-url&#160;: "javascript:alert(1)"; <br>
							 }  // and all other URLs<br>
							 { <br>
								text-size: "expression(alert( 'XSS'))"; <br>
							 }   // only in IE<br>
							</p>
							</div>
							<p>Except for alphanumeric characters, escape all characters with ASCII values less than 256 with the \HH escaping format. DO NOT 
								use any escaping shortcuts like \" because the quote character may be matched by the HTML attribute parser which runs first. 
								These escaping shortcuts are also susceptible to "escape-the-escape" attacks where the attacker sends \" and the vulnerable code 
								turns that into \\" which enables the quote.
							</p>
							<p>If attribute is quoted, breaking out requires the corresponding quote.  All attributes should be quoted but your encoding 
										should be strong enough to prevent XSS when untrusted data is placed in unquoted contexts. Unquoted attributes can be broken out 
										of with many characters including [space]&#160;% * + , - /&#160;; &lt; = &gt; ^ and |.  Also, the &lt;/style&gt; tag will close 
										the style block even though it is inside a quoted string because the HTML parser runs before the JavaScript parser. Please note 
										that we recommend aggressive CSS encoding and validation to prevent XSS attacks for both quoted and unquoted attributes.
							</p>
							<p>See the ESAPI reference implementation of CSS escaping and unescaping.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
								String safe = ESAPI.encoder( ).encodeForCSS( request.getParameter( "input" ) );
								</p>
							</div>
								<h5><li><span>RULE #5 - URL Escape Before Inserting Untrusted Data into HTML URL Parameter Values</span></li></h5>
							<p>Rule #5 is for when you want to put untrusted data into HTTP GET parameter value. 
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
							<p id="code-tag" style="font-size:70%">
							 &lt;a href= "http&#x3a;&#x2f;&#x2f;www.somesite.com&#x3f;test&#x3d;<b> ...ESCAPE UNTRUSTED DATA BEFORE PUTTING HERE..." </b>&gt;
									link&lt;/a &gt;       
							</p>
							</div>
							<p>Except for alphanumeric characters, escape all characters with ASCII values less than 256 with the&#160;%HH escaping format.  
								Including untrusted data in data: URLs should not be allowed as there is no good way to disable attacks with escaping to prevent 
								switching out of the URL. All attributes should be quoted. Unquoted attributes can be broken out of with many characters 
								including [space]&#160;% * + , - /&#160;; &lt; = &gt; ^ and |. Note that entity encoding is useless in this context.
							</p><p>See the ESAPI reference implementation</a> of URL escaping and unescaping.
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
									String safe = ESAPI.encoder( ).encodeForURL( request.getParameter( "input" ) );
								</p>
							</div>
							<p>WARNING: Do not encode complete or relative URL's with URL encoding! If untrusted input is meant to be placed into href, src 
								or other URL-based attributes, it should be validated to make sure it does not point to an unexpected protocol, especially 
								Javascript links. URL's should then be encoded based on the context of display like any other piece of data. For example, user 
								driven URL's in HREF links should be attribute encoded. For example:
							</p>
							<div style="border: 1px dashed #444444; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; padding: 4px; 
									margin-left: +0px; margin-right: +0px;">
								 <p id="code-tag" style="font-size:70%">
								 String userURL = request.getParameter( "userURL" )
								 boolean isValidURL = ESAPI.validator( ).isValidInput( "URLContext" , userURL, "URL", 255, false); 
								 if (isValidURL) { &lt;a href= "&lt;%= encoder.encodeForHTMLAttribute( userURL )%&gt;"&gt;link&lt;/a&gt; }
								</p>
							</div>
							<h5><li><span>RULE #6 - Sanitize HTML Markup with a Library Designed for the Job</span></li></h5>
							<p>If your application handles markup -- untrusted input that is supposed to contain HTML -- it can be very difficult to 
									validate. Encoding is also difficult, since it would break all the tags that are supposed to be in the input. Therefore, you need 
									a library that can parse and clean HTML formatted text.  There are several available at OWASP that are simple to use:
							</p><p><b>OWASP AntiSamy</b> - <a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/Category:OWASP_AntiSamy_Project');"><u>https://www.owasp.org/ index.php/Category: OWASP_AntiSamy_Project</u></a>
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +10px; margin-right: +10px;">
								 <p id="code-tag" style="font-size:70%">
								 import org.owasp.validator.html.*;<br>
								  Policy policy = Policy.getInstance( POLICY_FILE_LOCATION );<br>
								  AntiSamy as = new AntiSamy();<br>
								  CleanResults cr = as.scan( dirtyInput, policy );<br>
								  MyUserDAO.storeUserProfile( cr.getCleanHTML() ); // some custom function<br>
								</p>
							</div>
							<p><b>OWASP Java HTML Sanitizer</b> - <a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/OWASP_Java_HTML_Sanitizer_Project');"><u>https:// www.owasp.org/ index.php/ <br>OWASP_Java_HTML_ Sanitizer_Project</u></a>
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">import org.owasp.html.Sanitizers;<br>
								  import org.owasp.html.PolicyFactory;<br>
								  PolicyFactory sanitizer = Sanitizers.FORMATTING.and( Sanitizers.BLOCKS );<br>
								  String cleanResults = sanitizer.sanitize( "&lt;p&gt;Hello , &lt;b&gt;World!&lt;/b&gt;" );<br>
								</p>
							</div>
							<p>For more information on OWASP Java HTML Sanitizer policy construction, see 
							<a id="hyperlink" href="javascript:loadURL('http://owasp-java-html-sanitizer.googlecode.com/svn/trunk/distrib/javadoc/org/owasp/html/Sanitizers.html');">
								http://owasp-java -html-sanitizer .googlecode.com/svn/trunk/ distrib/javadoc/org/owasp /html/Sanitizers.html
								</a>
							</p><p><b>Other libraries that provide HTML Sanitization include:</b><br />
							</p>
							
							PHP Html Purifier - 
							<a id="hyperlink" href="javascript:loadURL('http://htmlpurifier.org/');">
							http://htmlpurifier.org/<br/></a>
							
							JavaScript/Node.JS Bleach - 
							<a id="hyperlink" href="javascript:loadURL('https://github.com/ecto/bleach');">
							https://github.com/ ecto/ bleach<br /></a>
							
							Python Bleach - 
							<a id="hyperlink" href="javascript:loadURL('https://pypi.python.org/pypi/bleach');">https://pypi.python.org/ pypi/ bleach</u></a>
							</p>
								<h5><li><span>RULE #7 - Prevent DOM-based XSS</span></li></h5>
								<p>For details on what DOM-based XSS is, and defenses against this type of XSS flaw, please see the OWASP article on <a id="hyperlink" href=
								"javascript:loadURL('https:/www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet');" title="DOM based XSS Prevention Cheat Sheet">DOM based XSS Prevention Cheat 
								Sheet</a>.
							</p>
								<h5><li><span>Bonus Rule #1: Use HTTP Only cookie flag</span></li></h5>
								<p>Preventing all XSS flaws in an application is hard, as you can see. To help mitigate the impact of an XSS flaw on your site, 
								OWASP also recommends you set the HTTPOnly flag on your session cookie and any custom cookies you have that are not accessed by 
								any Javascript you wrote. This cookie flag is typically on by default in .NET apps, but in other languages you have to set it 
								manually.  For more details on the HTTPOnly cookie flag, including what it does, and how to use it, see the OWASP article on <a 
								href="javascript:loadURL('https:/www.owasp.org/index.php/HTTPOnly');" id="hyperlink" title="HTTPOnly" class="mw-redirect">HTTPOnly</a>.
								</p>
								<h5><li><span>Bonus Rule #2: Implement Content Security Policy</span></li></h5>
								<p>There is another good complex solution to mitigate the impact of an XSS flaw called Content Security Policy. It's a browser 
									side mechanism which allows you to create source whitelists for client side resources of your web application, e.g. JavaScript, CSS, images, etc. CSP 
									via special HTTP header instructs the browser to only execute or render resources from those sources. For example this CSP 
								</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
									padding: 4px;margin-left: +20px; margin-right: +20px;">
								<p id="code-tag" style="font-size:70%">
								Content-Security-Policy: default-src: 'self'; script-src: 'self' static.domain.tld
								</p>
							</div>
							<p>will instruct web browser to load all resources only from the page's origin and JavaScript source code files additionaly from 
								static.domain.tld. For more details on Content Security Policy, including what it does, and how to use it, see the OWASP article 
								on  <a id="hyperlink" href="javascript:loadURL('https:/www.owasp.org/index.php/Content_Security_Policy');" title="Content Security Policy">Content_Security_Policy</a>
							</p>
							</ul>	
						</ol>
						<ol start="2">						
							<h4><li><span>XSS Prevention Rules Summary</span></li></h4>
							<p>The following snippets of HTML demonstrate how to safely render untrusted data in a variety of different contexts. 
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
								padding: 4px;margin-left: +5px; margin-right: +5px;">
							
								<b>Data Type : </b>String<br>
								<b>Context : </b>HTML Body<br>
								<b>Code Sample : </b>&lt;span&gt;<span style="color:red;"> UNTRUSTED DATA </span>&lt;/span&gt;<br>
								<b>Defense : </b><ul><li>HTML Entity Encoding</li></ul>
								<div class="decoration"></div>
								
								<b>Data Type : </b>String<br>
								<b>Context : </b>Safe HTML Attributes<br>
								<b>Code Sample : </b>&lt;input type="text" name="fname" value="<span style="color:red;"> UNTRUSTED DATA </span> "&gt;<br>
								<b>Defense : </b><ul><li>Aggressive HTML Entity Encoding</li><li>Only place untrusted data into a whitelist of safe 
									attributes (listed below).</li><li>Strictly validate unsafe attributes such as background, id and name.</ul>
								<div class="decoration"></div>
								
								<b>Data Type : </b>String<br>
								<b>Context : </b>GET Parameter<br>
								<b>Code Sample : </b>&lt;a href="/site/search?value=<span style="color:red;"> UNTRUSTED DATA </span>"&gt;clickme&lt;/a&gt;<br>
								<b>Defense : </b><ul><li>URL Encoding</li></ul>
								<div class="decoration"></div>
								
								<b>Data Type : </b>String<br>
								<b>Context : </b>Untrusted URL in a SRC or HREF attribute<br>
								<b>Code Sample : </b>&lt;a href="<span style="color:red;"> UNTRUSTED URL </span>"&gt;clickme&lt;/a&gt;<br />&lt;iframe src="
									<span style="color:red;"> UNTRUSTED URL </span>" /&gt;<br>
								<b>Defense : </b>
									<ul>
									<li>Canonicalize input</li>
									<li>URL Validation</li>
									<li>Safe URL verification</li>
									<li>Whitelist http and https URL's only (<a id="hyperlink" href="javascript:loadURL('https:/www.owasp.org/index.php/Avoid_the_JavaScript_Protocol_to_Open_a_new_Window" title=
										"Avoid the JavaScript Protocol to Open a new Window');">Avoid the JavaScript Protocol to Open a new Window</a>)</li>
									<li>Attribute encoder</li>
									</ul>
								<div class="decoration"></div>
								
								<b>Data Type : </b>String<br>
								<b>Context : </b>CSS Value<br>
								<b>Code Sample : </b>&lt;div style="width: <span style="color:red;"> UNTRUSTED DATA </span>;"&gt;Selection&lt;/div&gt;<br>
								<b>Defense : </b>
								<ul>
									<li>Strict structural validation</li>
									<li>CSS Hex encoding</li>
									<li>Good design of CSS Features</li>
								</ul>
								<div class="decoration"></div>
								
								<b>Data Type : </b>String<br>
								<b>Context : </b>JavaScript Variable<br>
								<b>Code Sample : </b>&lt;script&gt;var currentValue='<span style="color:red;"> UNTRUSTED DATA </span>';&lt;/script&gt;<br />
								&lt;script&gt;someFunction('<span style="color:red;">UNTRUSTED DATA</span>');&lt;/script&gt;<br>
								<b>Defense : </b>
								<ul>
									<li>Ensure JavaScript variables are quoted</li>
									<li>JavaScript Hex Encoding</li>
									<li>JavaScript Unicode Encoding</li>
									<li>Avoid backslash encoding (\" or \' or \\)</li>
								</ul>
								<div class="decoration"></div>
								
								<b>Data Type : </b>HTML<br>
								<b>Context : </b>HTML Body<br>
								<b>Code Sample : </b>&lt;div&gt;<span style="color:red;"> UNTRUSTED HTML </span>&lt;/div&gt;<br>
								<b>Defense : </b>
								<ul>
									<li>HTML Validation (JSoup, AntiSamy, HTML Sanitizer)</li>
								</ul>
								<div class="decoration"></div>
								
								<b>Data Type : </b>String<br>
								<b>Context : </b>DOM XSS<br>
								<b>Code Sample : </b>&lt;script&gt;<br>document.write(<span style="color:red;">" UNTRUSTED INPUT: " + document.location.hash
									</span>); &lt;script/&gt;<br>
								<b>Defense : </b>
								<ul>
									<li>DOM based XSS Prevention Cheat Sheet</li>
								</ul>
							</div>							
							
							<p>
							<i>
							<b>Safe HTML Attributes include:</b></i> align, alink, alt, bgcolor, border, cellpadding, cellspacing, class, color, cols, 
								colspan, coords, dir, face, height, hspace, ismap, lang, marginheight, marginwidth, multiple, nohref, noresize, noshade, nowrap, 
								ref, rel, rev, rows, rowspan, scrolling, shape, span, summary, tabindex, title, usemap, valign, value, vlink, vspace, width
							</p>
							<h4><li><span>Output Encoding Rules Summary</span></li></h4>
									<p>The purpose of output encoding (as it relates to Cross Site Scripting) is to convert untrusted input into a safe form where 
									the input is displayed as <b>data</b> to the user without executing as <b>code</b> in the browser. The following charts details a 
									list of critical output encoding methods needed to stop Cross Site Scripting.
							</p>						
								<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
									padding: 4px;margin-left: +5px; margin-right: +5px;">
								
								<b>Encoding Type : </b>HTML Entity Encoding<br>
								<b>Encoding Mechanism : </b>Convert &amp; to &amp;amp;<br />Convert &lt; to &amp;lt;<br />Convert &gt; to &amp;gt;<br />
									Convert " to &amp;quot;<br />Convert ' to &amp;#x27;<br />Convert / to &amp;#x2F;
								<div class="decoration"></div>							
								<b>Encoding Type : </b>HTML Attribute Encoding<br>
								<b>Encoding Mechanism : </b>Except for alphanumeric characters, escape all characters with the HTML Entity &amp;#xHH; format, 
									including spaces. (HH = Hex Value)
								<div class="decoration"></div>
								<b>Encoding Type : </b>URL Encoding<br>
								<b>Encoding Mechanism : </b>Standard percent encoding, see: <u>http://www.w3schools.com<br>/tags/ref_urlencode.asp</u>. URL 
									encoding should only be used to encode parameter values, not the entire URL or path fragments of a URL.
								<div class="decoration"></div>
								<b>Encoding Type : </b>JavaScript Encoding<br>
								<b>Encoding Mechanism : </b>Except for alphanumeric characters, escape all characters with the \uXXXX unicode escaping format 
									(X = Integer).
								<div class="decoration"></div>
								<b>Encoding Type : </b>CSS Hex Encoding<br>
								<b>Encoding Mechanism : </b>CSS escaping supports \XX and \XXXXXX. Using a two character escape can cause problems if the 
									next character continues the escape sequence. There are two solutions (a) Add a space after the CSS escape (will be ignored 
									by the CSS parser) (b) use the full amount of CSS escaping possible by zero padding the value.								
								</div>
						</ol>					
							</td>						
						</tr>	
			<tr id="details8" onClick="toggle8();">
				<td id="cheatsheet-table-row">		
				  <a href="#six" class="option-header-link" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">8.</h1>
					</div>		
					<div id="option-header-layout">					
						<strong id="option-header-label">Preventing CSRF</strong>						
					</div>					
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>
				  </a>
				  <div class="decoration_blank" id="eight"></div>
				</td>
			</tr>	
						<tr id="row8">
							<td class="container" id="row-details">
							<h4>Cross-Site Request Forgery (CSRF)</h4>
							<p>Cross-Site Request Forgery (CSRF) is a type of attack that occurs when a malicious Web site, email, blog, instant message, or 
program causes a user's Web browser to perform an unwanted action on a trusted site for which the user is currently 
authenticated. The impact of a successful cross-site request forgery attack is limited to the capabilities exposed by the 
vulnerable application. For example, this attack could result in a transfer of funds, changing a password, or purchasing an item 
in the user's context. In effect, CSRF attacks are used by an attacker to make a target system perform a function (funds 
Transfer, form submission etc.) via the target's browser without knowledge of the target user, at least until the unauthorized 
function has been committed.
							</p>
							<p>Impacts of successful CSRF exploits vary greatly based on the role of the victim. When targeting a normal user, a successful 
CSRF attack can compromise end-user data and their associated functions. If the targeted end user is an administrator account, a 
CSRF attack can compromise the entire Web application. The sites that are more likely to be attacked are community Websites 
(social networking, email) or sites that have high dollar value accounts associated with them (banks, stock brokerages, bill pay 
services). This attack can happen even if the user is logged into a Web site using strong encryption (HTTPS). Utilizing social 
engineering, an attacker will embed malicious HTML or JavaScript code into an email or Website to request a specific 'task url'. 
The task then executes with or without the user's knowledge, either directly or by utilizing a Cross-site Scripting flaw (ex: 
Samy MySpace Worm).
							</p>
							<p>For more information on CSRF, please see the OWASP Cross-Site Request Forgery (CSRF) page.
							</p>
							<ol type="A">
							<h4><li><span>Prevention Measures That Do NOT Work</span></li></h4>
							<ol type="a">
							<h5><li><span>Using a Secret Cookie</span></li></h5>
							<p>Remember that all cookies, even the secret ones, will be submitted with every request. All authentication tokens will be 
submitted regardless of whether or not the end-user was tricked into submitting the request. Furthermore, session identifiers are 
simply used by the application container to associate the request with a specific session object. The session identifier does not 
verify that the end-user intended to submit the request. 
							</p>
							<h5><li><span>Only Accepting POST Requests</span></li></h5>
							<p>Applications can be developed to only accept POST requests for the execution of business logic. The misconception is that 
since the attacker cannot construct a malicious link, a CSRF attack cannot be executed. Unfortunately, this logic is incorrect. 
There are numerous methods in which an attacker can trick a victim into submitting a forged POST request, such as a simple form 
hosted in an attacker's Website with hidden values. This form can be triggered automatically by JavaScript or can be triggered by 
the victim who thinks the form will do something else.
							</p>
							<h5><li><span>Multi-Step Transactions</span></li></h5>
							<p>Multi-Step transactions are not an adequate prevention of CSRF. As long as an attacker can predict or deduce each step of the 
completed transaction, then CSRF is possible.
							</p>
							<h5><li><span>URL Rewriting</span></li></h5>
							<p>This might be seen as a useful CSRF prevention technique as the attacker can not guess the victim's session ID. However, the 
userâ€™s credential is exposed over the URL.
							</p>
							</ol>
							<h4><li><span>General Recommendation: Synchronizer Token Pattern</span></li></h4>
							<p>In order to facilitate a "transparent but visible" CSRF solution, developers are encouraged to adopt the Synchronizer Token 
Pattern (<a id="hyperlink" href="javascript:loadURL('http://www.corej2eepatterns.com/Design/PresoDesign.htm');">http://www.corej2eepatterns.com /Design/PresoDesign.htm</a>). The synchronizer token pattern requires the generating 
of random "challenge" tokens that are associated with the user's current session. These challenge tokens are then inserted within 
the HTML forms and links associated with sensitive server-side operations. When the user wishes to invoke these sensitive 
operations, the HTTP request should include this challenge token. It is then the responsibility of the server application to 
verify the existence and correctness of this token. By including a challenge token with each request, the developer has a strong 
control to verify that the user actually intended to submit the desired requests. Inclusion of a required security token in HTTP 
requests associated with sensitive business functions helps mitigate CSRF attacks as successful exploitation assumes the attacker 
knows the randomly generated token for the target victim's session. This is analogous to the attacker being able to guess the 
target victim's session identifier. The following synopsis describes a general approach to incorporate challenge tokens within 
the request.
							</p><p>When a Web application formulates a request (by generating a link or form that causes a request when submitted or clicked 
by the user), the application should include a hidden input parameter with a common name such as "CSRFToken". The value of this 
token must be randomly generated such that it cannot be guessed by an attacker. Consider leveraging the 
java.security.SecureRandom class for Java applications to generate a sufficiently long random token. Alternative generation 
algorithms include the use of 256-bit BASE64 encoded hashes. Developers that choose this generation algorithm must make sure that 
there is randomness and uniqueness utilized in the data that is hashed to generate the random token.
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">
							   &lt;form action="/transfer.do" method="post"&gt;<br>
							   &lt;input type="hidden" name="CSRFToken" <br>
							   value= " OWY4NmQwODE4ODRjN2Q2NTlhMmZlYWE...<br>
							   wYzU1YWQwMTVhM2JmNGYxYjJiMGI4MjJjZDE1ZDZ...<br>
							   MGYwMGEwOA=="&gt;<br>
							   ...<br>
							   &lt;/form&gt;<br>
							   </p>
							   </div>
							<p>In general, developers need only generate this token once for the current session. After initial generation of this token, the 
value is stored in the session and is utilized for each subsequent request until the session expires. When a request is issued by 
the end-user, the server-side component must verify the existence and validity of the token in the request as compared to the 
token found in the session. If the token was not found within the request or the value provided does not match the value within 
the session, then the request should be aborted, token should be reset and the event logged as a potential CSRF attack in progress.
							</p><p>To further enhance the security of this proposed design, consider randomizing the CSRF token parameter name and or value 
for each request. Implementing this approach results in the generation of per-request tokens as opposed to per-session tokens. 
Note, however, that this may result in usability concerns. For example, the "Back" button browser capability is often hindered as 
the previous page may contain a token that is no longer valid. Interaction with this previous page will result in a CSRF false 
positive security event at the server. Regardless of the approach taken, developers are encouraged to protect the CSRF token the 
same way they protect authenticated session identifiers, such as the use of SSLv3/TLS.
							</p>
							<ol type="a">
							<h5><li><span>Disclosure of Token in URL</span></li></h5>
							<p>Many implementations of this control include the challenge token in GET (URL) requests as well as POST requests. This is often 
implemented as a result of sensitive server-side operations being invoked as a result of embedded links in the page or other 
general design patterns. These patterns are often implemented without knowledge of CSRF and an understanding of CSRF prevention 
design strategies. While this control does help mitigate the risk of CSRF attacks, the unique per-session token is being exposed 
for GET requests. CSRF tokens in GET requests are potentially leaked at several locations: browser history, HTTP log files, 
network appliances that make a point to log the first line of an HTTP request, and Referer headers if the protected site links to 
an external site.
							</p><p>In the latter case (leaked CSRF token due to the Referer header being parsed by a linked site), it is trivially easy for 
the linked site to launch a CSRF attack on the protected site, and they will be able to target this attack very effectively, 
since the Referer header tells them the site as well as the CSRF token. The attack could be run entirely from javascript, so that 
a simple addition of a script tag to the HTML of a site can launch an attack (whether on an originally malicious site or on a 
hacked site).  This attack scenario is easy to prevent, the referer will be omitted if the origin of the request is HTTPS.  
Therefore this attack does not affect web applications that are HTTPS only. 
							</p><p>The ideal solution is to only include the CSRF token in POST requests and modify server-side actions that have state 
changing affect to only respond to POST requests. This is in fact what the <a id="hyperlink" href="javascript:loadURL('http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1');">RFC 2616</a> requires for GET requests. If sensitive server-side 
actions are guaranteed to only ever respond to POST requests, then there is no need to include the token in GET requests.
							</p><p>In most JavaEE web applications, however, HTTP method scoping is rarely ever utilized when retrieving HTTP parameters from 
a request. Calls to "HttpServletRequest.getParameter" will return a parameter value regardless if it was a GET or POST. This is 
not to say HTTP method scoping cannot be enforced. It can be achieved if a developer explicitly overrides doPost() in the 
HttpServlet class or leverages framework specific capabilities such as the AbstractFormController class in Spring.
							</p><p>For these cases, attempting to retrofit this pattern in existing applications requires significant development time and 
cost, and as a temporary measure it may be better to pass CSRF tokens in the URL. Once the application has been fixed to respond 
to HTTP GET and POST verbs correctly, CSRF tokens for GET requests should be turned off.
							</p>
						<h5><li><span>Viewstate (ASP.NET)</span></li></h5>
							<p>ASP.NET has an option to maintain your ViewState. The ViewState indicates the status of a page when submitted to the server. 
The status is defined through a hidden field placed on each page with a &lt;form runat="server"&gt; control. Viewstate can be 
used as a CSRF defense, as it is difficult for an attacker to forge a valid Viewstate. It is not impossible to forge a valid 
Viewstate since it is feasible that parameter values could be obtained or guessed by the attacker. However, if the current 
session ID is added to the ViewState, it then makes each Viewstate unique, and thus immune to CSRF. 
							</p>
							<p>To use the ViewStateUserKey property within the Viewstate to protect against spoofed post backs. Add the following in the 
OnInit virtual method of the Page-derived class (This property must be set in the Page.Init event)
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">
									protected override OnInit(EventArgs e) {<br>
									base.OnInit(e); <br>
									if (User.Identity.IsAuthenticated)<br>
									ViewStateUserKey = Session.SessionID; }<br>
								</p>
							</div>
							<p>
								The following keys the Viewstate to an individual using a unique value of your choice.
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">
							   
								(Page.ViewStateUserKey)
							</p>
							</div>
							<p>This must be applied in Page_Init because the key has to be provided to ASP.NET before Viewstate is loaded. This option has 
been available since ASP.NET 1.1.
							</p>
							<p>However, there are limitations on this mechanism.  Such as, ViewState MACs are only checked on POSTback, so any other 
application requests not using postbacks will happily allow CSRF.
							</p>
						<h5><li><span>Double Submit Cookies</span></li></h5>
							<p>Double submitting cookies is defined as sending a random value in both a cookie and as a request parameter, with the server 
verifying if the cookie value and request value are equal. 
							</p><p>When a user authenticates to a site, the site should generate a (cryptographically strong) pseudorandom value and set it 
as a cookie on the user's machine separate from the session id. The site does not have to save this value in any way. The site 
should then require every sensitive submission to include this random value as a hidden form value (or other request parameter) 
and also as a cookie value. An attacker cannot read any data sent from the server or modify cookie values, per the same-origin 
policy. This means that while an attacker can send any value he wants with a malicious CSRF request, the attacker will be unable 
to modify or read the value stored in the cookie. Since the cookie value and the request parameter or form value must be the 
same, the attacker will be unable to successfully submit a form unless he is able to guess the random CSRF value.
							</p><p>Direct Web Remoting (DWR) Java library version 2.0 has CSRF protection built in as it implements the double cookie 
submission transparently.
							</p>
							<h5><li><span>Encrypted Token Pattern</span></li></h5>
							<h6><span>Overview</span></h6>
							<p>The Encrypted Token Pattern leverages an encryption, rather than comparison, method of Token-validation. After successful 
authentication, the server generates a unique Token comprised of the user's ID, a timestamp value and a nonce, using a unique key 
available only on the server. This Token is returned to the client and embedded in a hidden field. Subsequent AJAX requests 
include this Token in the request-header, in a similar manner to the Double-Submit pattern. Non-AJAX form-based requests will 
implicitly persist the Token in its hidden field, although I recommend persisting this data in a custom HTTP header in such 
cases. On receipt of this request, the server reads and decrypts the Token value with the same key used to create the Token.
							</p>
						<h6><span>Validation</span></h6>
							<p>On successful Token-decryption, the server has access to parsed values, ideally in the form of claims. These claims are 
processed by comparing the UserId claim to any potentially stored UserId (in a Cookie or Session variable, if the site already 
contains a means of authentication). The Timestamp is validated against the current time, preventing replay attacks.
							Alternatively, in the case of a CSRF attack, the server will be unable to decrypt the poisoned Token, and can block and log the 
attack.
							</p>
							<p>This pattern exists primarily to allow developers and architects protect against CSRF without session-dependency. It also 
addresses some of the shortfalls in other stateless approaches, such as the need to store data in a Cookie, circumnavigating the 
Cookie-subdomain and HTTPONLY issues.
							</p>
							</ol>
						<h4><li><span>CSRF Prevention without a Synchronizer Token</span></li></h4>
							<p>CSRF can be prevented in a number of ways. Using a Synchronizer Token is one way that an application can rely upon the 
Same-Origin Policy to prevent CSRF by maintaining a secret token to authenticate requests.  This section details other ways that 
an application can prevent CSRF by relying upon similar rules that CSRF exploits can never break.
							</p>
							<ol type="a">
							<h5><li><span>Checking The Referer Header</span></li></h5>
							<p>Although it is trivial to spoof the referer header on your own browser,  it is impossible to do so in a CSRF attack.  Checking 
the referer is a commonly used method of preventing CSRF on embedded network devices because it does not require a per-user 
state.  This makes a referer a useful method of CSRF prevention when memory is scarce.  This method of CSRF mitigation is also 
commonly used with unauthenticated requests,  such as requests made prior to establishing a session state which is required to 
keep track of a synchronization token. 
							</p><p>However, checking the referer is considered to be a weaker from of CSRF protection.  For example,  open redirect 
vulnerabilities can be used to exploit GET-based requests that are protected with a referer check and some organizations or 
browser tools remove referrer headers as a form of data protection.  There are also common implementation mistakes with referer 
checks.  For example if the CSRF attack originates from an HTTPS domain then the referer will be omitted.  In this case the lack 
of a referer should be considered to be an attack when the request is performing a state change.   Also note that the attacker 
has limited influence over the referer.   For example,  if the victim's domain is "site.com" then an attacker have the CSRF 
exploit originate from "site.com.attacker.com" which may fool a broken referer check implementation.  XSS can be used to bypass a 
referer check.
							</p><p>In short, referer checking is a reasonable form of CSRF intrusion detection and prevention even though it is not a 
complete protection. Referer checking can detect some attacks but not stop all attacks. For example, if you HTTP referrer is from 
a different domain and you are expecting requests from your domain only, you can safely block that request.
							</p>
						<h5><li><span>Checking The Origin Header</span></li></h5>
							<p>The Origin HTTP Header standard was introduced as a method of defending against CSRF and other Cross-Domain attacks.  Unlike 
the referer, the origin will be present in HTTP request that originates from an HTTPS url.
							</p><p>If the origin header is present,  then it should be checked for consistency.
							</p>
						<h5><li><span>Challenge-Response</span></li></h5>
							<p>Challenge-Response is another defense option for CSRF. The following are some examples of challenge-response options.
							</p>
							<ul>
							<li>CAPTCHA
							</li>
							<li>Re-Authentication (password)
							</li>
							<li>One-time Token
							</li>
							</ul>
							<p>While challenge-response is a very strong defense to CSRF (assuming proper implementation), it does impact user experience. 
For applications in need of high security, tokens (transparent) and challenge-response should be used on high risk functions.
							</p>
							</ol>
						<h4><li><span>Client/User Prevention</span></li></h4>
							<p>Since CSRF vulnerabilities are reportedly widespread, it is recommended to follow best practices to mitigate risk. Some 
mitigating include: 
							</p>
							<ul>
							<li> Logoff immediately after using a Web application 
							</li>
							<li> Do not allow your browser to save username/passwords, and do not allow sites to "remember" your login 
							</li>
							<li> Do not use the same browser to access sensitive applications and to surf the Internet freely (tabbed browsing). 
							</li>
							<li> The use of plugins such as No-Script makes POST based CSRF vulnerabilities difficult to exploit.  This is because JavaScript 
is used to automatically submit the form when the exploit is loaded. Without JavaScript the attacker would have to trick the user 
into submitting the form manually. 
							</li>
							</ul>
							<p>Integrated HTML-enabled mail/browser and newsreader/browser environments pose additional risks since simply viewing a mail 
message or a news message might lead to the execution of an attack. 
							</p>
							<h4><li><span>No Cross-Site Scripting (XSS) Vulnerabilities</span></li></h4>
							<p>Cross-Site Scripting is not necessary for CSRF to work. However, any cross-site scripting vulnerability can be used to defeat 
token, Double-Submit cookie, referer and origin based CSRF defenses.  This is because an XSS payload can simply read any page on 
the site using a XMLHttpRequest and obtain the generated token from the response, and include that token with a forged request. 
This technique is exactly how the MySpace (Samy) worm defeated MySpace's anti CSRF defenses in 2005, which enabled the worm to 
propagate. XSS cannot defeat challenge-response defenses such as Captcha, re-authentication or one-time passwords. It is 
imperative that no XSS vulnerabilities are present to ensure that CSRF defenses can't be circumvented. Please see the OWASP XSS 
Prevention Cheat Sheet for detailed guidance on how to prevent XSS flaws.
							</p>						
							</ol>
							</td>
						</tr>				
			<tr id="details9" onClick="toggle9();">
				<td id="cheatsheet-table-row">		
				  <a href="#sevan" class="option-header-link" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">9.</h1>
					</div>		
					<div id="option-header-layout">					
						<strong id="option-header-label">Malicious Site Framing/Clickjacking</strong>						
					</div>					
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>
				  </a>
				  <div class="decoration_blank" id="nine"></div>
				</td>
			</tr>		
					<tr id="row9">
							<td class="container" id="row-details">
													
							<p>This cheat sheet is focused on providing developer guidance on Clickjack/UI Redress attack prevention.
							</p>
							<p>The most popular way to defend against Clickjacking is to include some sort of "frame-breaking" functionality which prevents 
other web pages from framing the site you wish to defend. This cheat sheet will discuss two methods of implementing 
frame-breaking: first is X-Frame-Options headers (used if the browser supports the functionality); and second is javascript 
frame-breaking code.
							</p>
							<ol type="A">
							<h4><li><span>Defending with X-Frame-Options Response Headers</span></li></h4>
							<p>The X-Frame-Options HTTP response header can be used to indicate whether or not a browser should be allowed to render a page 
in a &lt;frame&gt; or &lt;iframe&gt;. Sites can use this to avoid Clickjacking attacks, by ensuring that their content is not 
embedded into other sites.
							</p>
							<ol type="a">
							<h5><li><span>X-Frame-Options Header Types</span></li></h5>
							<p>There are three possible values for the X-Frame-Options headers:
							</p>
							<ul>
							<li> <b>DENY</b>, which prevents any domain from framing the content.
							</li>
							<li> <b>SAMEORIGIN</b>, which only allows the current site to frame the content.
							</li>
							<li> <b>ALLOW-FROM uri</b>, which permits the specified 'uri' to frame this page. (e.g., ALLOW-FROM http&#58;//www.example.com) 
The ALLOW-FROM option is a relatively recent addition (circa 2012) and may not be supported by all browsers yet.  BE CAREFUL 
ABOUT DEPENDING ON ALLOW-FROM. If you apply it and the browser does not support it, then you will have NO clickjacking defense in 
place.
							</li>
							</ul>
							<h5><li><span>Browser Support</span></li></h5>
							<p>The following browsers support X-Frame-Options headers.
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
							
							<b>Browser : </b>Chrome<br>
							<b>DENY/SAMEORIGIN Support Introduced : </b>4.1.249.1042<br>
							<b>ALLOW-FROM Support Introduced : </b>Not supported/Bug reported<br>
								<div class="decoration"></div>	
							<b>Browser : </b>Firefox (Gecko)<br>
							<b>DENY/SAMEORIGIN Support Introduced : </b>3.6.9 (1.9.2.9)<br>
							<b>ALLOW-FROM Support Introduced : </b>18.0<br>
								<div class="decoration"></div>	
							<b>Browser : </b>Internet Explorer<br>
							<b>DENY/SAMEORIGIN Support Introduced : </b>8.0	<br>
							<b>ALLOW-FROM Support Introduced : </b>9.0	<br>
								<div class="decoration"></div>	
							<b>Browser : </b>Opera<br>
							<b>DENY/SAMEORIGIN Support Introduced : </b>10.50	<br>
							<b>ALLOW-FROM Support Introduced : </b>-<br>
								<div class="decoration"></div>	
							<b>Browser : </b>Safari<br>
							<b>DENY/SAMEORIGIN Support Introduced : </b>4.0		<br>
							<b>ALLOW-FROM Support Introduced : </b>Not supported/Bug reported	<br>						
							
							</div>
							<h5><li><span>Implementation</span></li></h5>
							<p>To implement this protection, you need to add the X-Frame-Options HTTP Response header to any page that you want to protect 
from being clickjacked via framebusting. One way to do this is to add the HTTP Response Header manually to every page.  A 
possibly simpler way is to implement a filter that automatically adds the header to every page.
							</p>
							<p>OWASP has an <a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/ClickjackFilter_for_Java_EE');" title="ClickjackFilter for 
Java EE" class="mw-redirect">article and some code</a> that provides all the details for implementing this in the Java EE 
environment.
							</p>
							<p>The SDL blog has posted an <a id="hyperlink" href="javascript:loadURL('https:/www.owasp.orghttp://blogs.msdn.com/sdl/archive/2009/02/05/clickjacking-defense-in-ie8.aspx');">article</a> covering how to implement this in a 
.NET environment.
							</p>
							<h5><li><span>Common Defense Mistakes</span></li></h5>
							<p>Meta-tags that attempt to apply the X-Frame-Options directive DO NOT WORK. For example, &lt;meta http-equiv="X-Frame-Options" 
content="deny"&gt;) will not work. You must apply the X-FRAME-OPTIONS directive as HTTP Response Header as described above.
							</p>
							<h5><li><span>Limitations</span></li></h5>
							<ul>
							<li> <b>Per-page policy specification</b> 
							</li>
							</ul>
							<p>The policy needs to be specified for every page, which can complicate deployment. Providing the ability to enforce it for the 
entire site, at login time for instance, could simplify adoption.
							</p>
							<ul>
							<li> <b>Problems with multi-domain sites</b>
							</li>
							</ul>
							<p>The current implementation does not allow the webmaster to provide a whitelist of domains that are allowed to frame the page. 
While whitelisting can be dangerous, in some cases a webmaster might have no choice but to use more than one hostname.
							</p>
							<ul>
							<li> <b>Proxies</b>
							</li>
							</ul>
							<p>Web proxies are notorious for adding and stripping headers. If a web proxy strips the X-Frame-Options header then the site 
loses its framing protection.
							</p></ol>
						<h4><li><span>Best-for-now Legacy Browser Frame Breaking Script</span></li></h4>
							<p>One way to defend against clickjacking is to include a "frame-breaker" script
							in each page that should not be framed. The following methodology will prevent
							a webpage from being framed even in legacy browsers, that do not support the
							X-Frame-Options-Header.
							</p>
							<p>In the document HEAD element, add the following:
							</p>
							<p>First apply an ID to the style element itself:
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">
									&lt;style id=&quot;antiClickjack&quot;&gt; body{display:none !important;}&lt;/style&gt;
								</p>
							</div>
							<p>And then delete that style by its ID immediately after in the script:
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									&lt;script type=&quot;text/javascript&quot;&gt;<br>
									   if (self === top) {<br>
										   var antiClickjack = document.getElementById( &quot;antiClickjack&quot; );<br>
										   antiClickjack.parentNode.removeChild( antiClickjack );<br>
									   } else {<br>
										   top.location = self.location;<br>
									   }<br>
									&lt;/script&gt;<br>
							</p>
							</div>
							<p>This way, everything can be in the document HEAD and you only need one method/taglib in your API.
							</p>
							<p>Reference: <a rel="hyperlink" href="javascript:loadURL('https://www.codemagi.com/blog/post/194');">
							https://www.codemagi.com/blog/post/194</a>
							</p>
							<h4><li><span>window.confirm() Protection</span></li></h4>
							<p>The use of x-frame-options or a frame-breaking script is a more fail-safe method of clickjacking protection.  However, in 
scenarios where content must be frameable, then a window.confirm() can be used to help mitigate Clickjacking by informing the 
user of the action they are about to perform.
							</p>
							<p>Invoking window.confirm() will display a popup that cannot be framed.  If the window.confirm() originates from within an 
iframe with a different domain than the parent, then the dialog box will display what domain the window.confirm() originated 
from.  In this scenario the browser is displaying the origin of the dialog box to help mitigate Clickjacking attacks.  It should 
be noted that Internet Explorer is the only known browser that does not display the domain that the window.confirm() dialog box 
originated from,  to address this issue with Internet Explorer insure that the message within the dialog box contains contextual 
information about the type of action being performed.  For example:
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">
									&lt;script type=&quot;text/javascript&quot;&gt;<br>
									   var action_confirm = window.confirm("Are you sure you want to delete your youtube account?")<br>
									   if (action_confirm) {<br>
										   //... perform action<br>
									   } else {<br>
										   //...  The user does not want to perform the requested action.<br>
									   }<br>
									&lt;/script&gt;<br>
								</p>
							</div>
							<h4><li><span>Non-Working Scripts</span></li></h4>
							<p>Consider the following snippet which is <b>NOT recommended</b> for defending
							against clickjacking:
							</p>
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">
									&lt;script&gt;if (top!=self) top.location.href = self.location.href&lt;/script&gt;
								</p>
							</div>
							<p>This simple frame breaking script attempts to prevent the page from being incorporated into a frame or iframe by forcing the 
parent window to load the current frame's URL. Unfortunately, multiple ways of defeating this type of script have been made 
public. We outline some here.
							</p>
							<h5><span>a. Double Framing</span></h5>
							<p>Some frame busting techniques navigate to the correct page by assigning a value to parent.location. This works well if the 
victim page is framed by a single page. However, if the attacker encloses the victim in one frame inside another (a double 
frame), then accessing parent.location becomes a security violation in all popular browsers, due to the <b>descendant frame 
navigation policy</b>. This security violation disables the counter-action navigation.
							</p>
							<p><b>Victim frame busting code:</b>
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									if(top.location! = self.locaton) {<br>
									  parent.location = self.location;<br>
									}<br>
								</p>
							</div>
							<p><b>Attacker top frame:</b>
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									&lt;iframe src=&quot;attacker2.html&quot;&gt;
								</p>
							</div>
							<p><b>Attacker sub-frame:</b>
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									&lt;iframe src=&quot;http://www.victim.com&quot;&gt;
								</p>
							 </div>
							<h5><span>b. The onBeforeUnload Event</span></h5>
							<p>A user can manually cancel any navigation request submitted by a framed page. To exploit this, the framing page registers an 
onBeforeUnload handler which is called whenever the framing page is about to be unloaded due to navigation. The handler function 
returns a string that becomes part of a prompt displayed to the user. Say the attacker wants to frame PayPal. He registers an 
unload handler function that returns the string "Do you want to exit PayPal?". When this string is displayed to the user is 
likely to cancel the navigation, defeating PayPal's frame busting attempt.
							</p>
							<p>The attacker mounts this attack by registering an unload event on the top page using the
							following code:
							</p>
						 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									&lt;script&gt;<br>
									window.onbeforeunload = function()<br>
									{<br>
									  return &quot;Asking the user nicely&quot;;<br>
									}<br>
									&lt;/script&gt;<br>
									&lt;iframe src=&quot;http://www.paypal.com&quot;&gt;<br>
								</p>
							</div>
						<p>PayPal's frame busting code will generate a BeforeUnload event activating our function and prompting the user to cancel the 
navigation event.
							</p>
							<h5><span>c. No-Content Flushing</span></h5>
							<p>While the previous attack requires user interaction, the same attack can be done without prompting the user. Most browsers 
(IE7, IE8, Google Chrome, and Firefox) enable an attacker to automatically cancel the incoming navigation request in an 
onBeforeUnload event handler by repeatedly submitting a navigation request to a site responding with \204 - No Content." 
Navigating to a No Content site is effectively a NOP, but flushes the request pipeline, thus canceling the original navigation 
request. Here is sample code to do this:
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									var preventbust = 0<br>
									window.onbeforeunload = function() { killbust++ }<br>
									setInterval( function() {<br>
									  if(killbust &gt; 0){<br>
									  killbust = 2;<br>
									  window.top.location = 'http://nocontent204.com'<br>
									  }<br>
									}, 1);<br>
									&lt;iframe src=&quot;http://www.victim.com&quot;&gt;<br>
								</p>
							</div>
						<h5><span>d. Exploiting XSS filters</span></h5>
							<p>IE8 and Google Chrome introduced reflective XSS filters that help protect web pages from certain types of XSS attacks. Nava 
and Lindsay (at Blackhat) observed that these filters can be used to circumvent frame busting code. The IE8 XSS filter compares 
given request parameters to a set of regular expressions in order to look for obvious attempts at cross-site scripting. Using 
"induced false positives", the filter can be used to disable selected scripts. By matching the beginning of any script tag in the 
request parameters, the XSS filter will disable all inline scripts within the page, including frame busting scripts. External 
scripts can also be targeted by matching an external include, effectively disabling all external scripts. Since subsets of the 
JavaScript loaded is still functional (inline or external) and cookies are still available, this attack is effective for 
clickjacking.
							</p>
							<p><b>Victim frame busting code:</b>
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									&lt;script&gt;<br>
									if(top&#160;!= self) {<br>
									  top.location = self.location;<br>
									}<br>
									&lt;/script&gt;<br>
								</p>
							</div>
							<p><b>Attacker:</b>
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
								&lt;iframe src=&quot;http://www.victim.com/?v=&lt;script&gt;if''&gt;
								</p>
							</div>
							<p>The XSS filter will match that parameter "&lt;script&gt;if" to the beginning of the frame busting script on the victim and 
will consequently disable all inline scripts in the victim's page, including the frame busting script. The XSSAuditor filter 
available for Google Chrome enables the same exploit.
							</p>
							<h5><span>e. Clobbering top.location</span></h5>
							<p>Several modern browsers treat the location variable as a special immutable attribute across all contexts. However, this is not 
the case in IE7 and Safari 4.0.4 where the location variable can be redefined.
							</p>
							<p><b>IE7</b>
							Once the framing page redefines location, any frame busting code in a subframe that tries to read top.location will commit a 
security violation by trying to read a local variable in another domain. Similarly, any attempt to navigate by assigning 
top.location will fail.
							</p>
							<p><b>Victim frame busting code:</b>
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									if(top.location&#160;!= self.location) {<br>
									  top.location = self.location;<br>
									}<br>
								</p>
							</div>
							<p><b>Attacker:</b>
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
									&lt;script&gt; var location = &quot;clobbered&quot;;<br>
									&lt;/script&gt;<br>
									&lt;iframe src=&quot;http://www.victim.com&quot;&gt;<br>
									&lt;/iframe&gt;<br>
								</p>
							</div>
							<p><b>Safari 4.0.4</b>
							</p>
							<p>We observed that although location is kept immutable in most circumstances, when a custom location setter is defined via 
defineSetter (through window) the object location becomes undefined. The framing page simply does:
							</p>
							 <div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">							
								&lt;script&gt;<br>
								  window.defineSetter(&quot;location&quot; , function(){});<br>
								&lt;/script&gt;<br>
							</p>
							</div>
							<p>Now any attempt to read or navigate the top frame's location will fail.
							</p>
							<h5><span>f. Restricted zones</span></h5>
							<p>Most frame busting relies on JavaScript in the framed page to detect framing and bust itself out. If JavaScript is disabled in 
the context of the subframe, the frame busting code will not run. There are unfortunately several ways of restricting JavaScript 
in a subframe:
							</p>
							<ul>
							<li> <b>In IE 8:</b>  
								<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
									<p id="code-tag" style="font-size:70%">
										&lt;iframe src=&quot;http://www.victim.com&quot; security=&quot;restricted&quot;&gt;&lt;/iframe&gt;
									</p>
								</div>
							</li>
							<li> <b>In Chrome:</b> 
							<div style="border: 2px dashed #444444; Overflow:auto; margin-bottom: +20px; background-color: #D0D0D0; font-family: courier; 
padding: 4px;margin-left: +5px; margin-right: +5px;">
								<p id="code-tag" style="font-size:70%">
									&lt;iframe src=&quot;http://www.victim.com&quot; sandbox&gt;&lt;/iframe&gt;
								</p>
								</div>
							</li>
							<li><b> In Firefox and IE:</b> Activate designMode in parent page.
							</li>
							</ul>						
									</ol>		
							</td>
					</tr>				
		<tr id="details10" onClick="toggle10();">
				<td id="cheatsheet-table-row">		
				  <a href="#eight" class="option-header-link" id="cheatsheet-table-data">				
					<div id="option-skyblue">
						<h1 id="option-header">10.</h1>
					</div>		
					<div id="option-header-layout">					
						<strong id="option-header-label">Logging</strong>						
					</div>					
					<i class="fa fa-angle-down" id="option-header-label-arrow"></i>
				  </a>
				  <div class="decoration_blank" id="ten"></div>
				</td>
			</tr>		
						<tr id="row10">
							<td class="container" id="row-details">
													
							<p>This cheat sheet is focused on providing developers with concentrated guidance on building application logging mechanisms, 
especially related to security logging. Many systems enable network device, operating system, web server, mail server and 
database server logging, but often custom application event logging is missing, disabled or poorly configured. It provides much 
greater insight than infrastructure logging alone. Web application (e.g. web site or web service) logging is much more than 
having web server logs enabled (e.g. using Extended Log File Format).
							</p><p>Application logging should be consistent within the application, consistent across an organization's application portfolio 
and use industry standards where relevant, so the logged event data can be consumed, correlated, analyzed and managed by a wide 
variety of systems.
							</p>
							<ol type="A">
							<h4><li><span class="mw-headline" id="Purpose">Purpose</span></li></h4>
							<p>Application logging should be always be included for security events. Application logs are invaluable data for:
							</p>
							<ul type="square">
							<li> Identifying security incidents
							</li>
							<li> Monitoring policy violations
							</li>
							<li> Establishing baselines
							</li>
							<li> Providing information about problems and unusual conditions
							</li>
							<li> Contributing additional application-specific data for incident investigation which is lacking in other log sources
							</li>
							<li> Helping defend against vulnerability identification and exploitation through attack detection
							</li>
							</ul>
							<p>Application logging might also be used to record other types of events too such as:
							</p>
							<ul type="square">
							<li> Security events
							</li>
							<li> Business process monitoring e.g. sales process abandonment, transactions, connections
							</li>
							<li> Audit trails e.g. data addition, modification and deletion, data exports
							</li>
							<li> Performance monitoring e.g. data load time, page timeouts
							</li>
							<li> Compliance monitoring
							</li>
							<li> Data for subsequent requests for information e.g. data subject access, freedom of information, litigation, police and other 
regulatory investigations
							</li>
							<li> Legally sanctioned interception of data e.g application-layer wire-tapping
							</li>
							<li> Other business-specific requirements
							</li>
							</ul>
							<p>Process monitoring, audit and transaction logs/trails etc are usually collected for different purposes than security event 
logging, and this often means they should be kept separate. The types of events and details collected will tend to be different. 
For example a PCIDSS audit log will contain a chronological record of activities to provide an independently verifiable trail 
that permits reconstruction, review and examination to determine the original sequence of attributable transactions. It is 
important not to log too much, or too little. Use knowledge of the intended purposes to guide what, when and how much. The 
remainder of this cheat sheet primarily discusses security event logging.
							</p><p><br />
							</p>
							<h4><li><span>Design, implementation and testing</span></li></h4>
							<ol type="a">
							
							<h5><li><span>Event data sources</span></li></h5>
							<p>The application itself has access to a wide range of information events that should be used to generate log entries. Thus, the 
primary event data source is the application code itself.  The application has the most information about the user (e.g. 
identity, roles, permissions) and the context of the event (target, action, outcomes), and often this data is not available to 
either infrastructure devices, or even closely-related applications.
							</p><p>Other sources of information about application usage that could also be considered are:
							</p>
							<ul>
							<li> Client software e.g. actions on desktop software and mobile devices in local logs or using messaging technologies,  
JavaScript exception handler via Ajax, web browser such as using Content Security Policy (CSP) reporting mechanism
							</li>
							<li> Network firewalls
							</li>
							<li> Network and host intrusion detection systems (NIDS and HIDS)
							</li>
							<li> Closely-related applications e.g. filters built into web server software, web server URL redirects/rewrites to scripted 
custom error pages and handlers
							</li>
							<li> Application firewalls e.g. filters, guards, XML gateways, database firewalls, web application firewalls (WAFs)
							</li>
							<li> Database applications e.g. automatic audit trails, trigger-based actions
							</li>
							<li> Reputation monitoring services e.g. uptime or malware monitoring
							</li>
							<li> Other applications e.g. fraud monitoring, CRM
							</li>
							<li> Operating system e.g. mobile platform
							</li>
							</ul>
							<p>The degree of confidence in the event information has to be considered when including event data from systems in a different 
trust zone. Data may be missing, modified, forged, replayed and could be malicious â€“ it must always be treated as untrusted data. 
Consider how the source can be verified, and how integrity and non-repudiation can be enforced.
							</p>
							<h5><li><span>Where to record event data</span></li></h5>
							<p>Applications commonly write event log data to the file system or a database (SQL or NoSQL). Applications installed on desktops 
and on mobile devices may use local storage and local databases. Your selected framework may limit the available choices. All 
types of applications may send event data to remote systems (instead of or as well as more local storage). This could be a 
centralized log collection and management system (e.g. SIEM or SEM) or another application elsewhere. Consider whether the 
application can simply send its event stream, unbuffered, to stdout, for management by the execution environment.
							</p>
							<ul>
							<li> When using the file system, it is preferable to use a separate partition than those used by the operating system, other 
application files and user generated content
							<ul type="circle">
							<li> For file-based logs, apply strict permissions concerning which users can access the directories, and the permissions of 
files within the directories
							</li>
							<li> In web applications, the logs should not be exposed in web-accessible locations, and if done so, should have restricted 
access and be configured with a plain text MIME type (not HTML)
							</li>
							</ul>
							</li>
							<li> When using a database, it is preferable to utilize a separate database account that is only used for writing log data and 
which has very restrictive database , table, function and command permissions
							</li>
							<li> Use standard formats over secure protocols to record and send event data, or log files, to other systems e.g. Common Log 
File System (CLFS), Common Event Format (CEF) over syslog, possibly Common Event Expression (CEE) in future; standard formats 
facilitate integration with centralised logging services
							</li>
							</ul>
							<p>Consider separate files/tables for extended event information such as error stack traces or a record of HTTP request and 
response headers and bodies.
							</p>
							<h5><li><span>Which events to log</span></li></h5>
							<p>The level and content of security monitoring, alerting and reporting needs to be set during the requirements and design stage 
of projects, and should be proportionate to the information security risks. This can then be used to define what should be 
logged. There is no one size fits all solution, and a blind checklist approach can lead to unnecessary "alarm fog" that means 
real problems go undetected. Where possible, always log:
							</p>
							<ul>
							<li> Input validation failures e.g. protocol violations, unacceptable encodings, invalid parameter names and values
							</li>
							<li> Output validation failures e.g. database record set mismatch, invalid data encoding
							</li>
							<li> Authentication successes and failures
							</li>
							<li> Authorization (access control) failures
							</li>
							<li> Session management failures e.g. cookie session identification value modification
							</li>
							<li> Application errors and system events e.g. syntax and runtime errors, connectivity problems, performance issues, third party 
service error messages, file system errors, file upload virus detection, configuration changes
							</li>
							<li> Application and related systems start-ups and shut-downs, and logging initialization (starting, stopping or pausing)
							</li>
							<li> Use of higher-risk functionality e.g. network connections, addition or deletion of users, changes to privileges, assigning 
users to tokens, adding or deleting tokens, use of systems administrative privileges, access by application administrators,all 
actions by users with administrative privileges,  access to payment cardholder data, use of data encrypting keys, key changes, 
creation and deletion of system-level objects, data import and export including screen-based reports, submission of 
user-generated content - especially file uploads
							</li>
							<li> Legal and other opt-ins e.g. permissions for mobile phone capabilities, terms of use, terms &amp; conditions, personal data 
usage consent, permission to receive marketing communications
							</li>
							</ul>
							<p>Optionally consider if the following events can be logged and whether it is desirable information:
							</p>
							<ul>
							<li> Sequencing failure
							</li>
							<li> Excessive use
							</li>
							<li> Data changes
							</li>
							<li> Fraud and other criminal activities
							</li>
							<li> Suspicious, unacceptable or unexpected behavior
							</li>
							<li> Modifications to configuration
							</li>
							<li> Application code file and/or memory changes
							</li>
							</ul>
							<h5><li><span>Event attributes</span></li></h5>
							<p>Each log entry needs to include sufficient information for the intended subsequent monitoring and analysis. It could be full 
content data, but is more likely to be an extract or just summary properties. The application logs must record "when, where, who 
and what" for each event. The properties for these will be different depending on the architecture, class of application and host 
system/device, but often include the following:
							</p>
							<ul>
							<li> When
							<ul type="circle">
							<li> Log date and time (international format)
							</li>
							<li> Event date and time - the event time stamp may be different to the time of logging e.g. server logging where the client 
application is hosted on remote device that is only periodically or intermittently online
							</li>
							<li> Interaction identifier [Note A]
							</li>
							</ul>
							</li>
							<li> Where
							<ul type="circle">
							<li> Application identifier e.g. name and version
							</li>
							<li> Application address e.g. cluster/host name or server IPv4 or IPv6 address and port number, workstation identity, local 
device identifier
							</li>
							<li> Service e.g. name and protocol
							</li>
							<li> Geolocation
							</li>
							<li> Window/form/page e.g. entry point URL and HTTP method for a web application, dialogue box name
							</li>
							<li> Code location e.g. script name, module name
							</li>
							</ul>
							</li>
							<li> Who (human or machine user)
							<ul type="circle">
							<li> Source address e.g. user's device/machine identifier, user's IP address, cell/RF tower ID, mobile telephone number
							</li>
							<li> User identity (if authenticated or otherwise known) e.g. user database table primary key value, user name, license number
							</li>
							</ul type="circle">
							</li>
							<li> What
							<ul type="circle">
							<li> Type of event [Note B]
							</li>
							<li> Severity of event [Note B] e.g. {0=emergency, 1=alert, ..., 7=debug}, {fatal, error, warning, info, debug, trace}
							</li>
							<li> Security relevant event flag (if the logs contain non-security event data too)
							</li>
							<li> Description
							</li>
							</ul>
							</li>
							</ul>
							<p>Additionally consider recording:
							</p>
							<ul>
							<li> Secondary time source (e.g. GPS) event date and time
							</li>
							<li> Action - original intended purpose of the request e.g. Log in, Refresh session ID, Log out, Update profile
							</li>
							<li> Object e.g. the affected component or other object (user account, data resource, file) e.g. URL, Session ID, User account, 
File
							</li>
							<li> Result status -  whether the ACTION aimed at the OBJECT was successful e.g. Success, Fail, Defer
							</li>
							<li> Reason - why the status above occurred e.g. User not authenticated in database check ..., Incorrect credentials
							</li>
							<li> HTTP Status Code (web applications only) - the status code returned to the user (often 200 or 301)
							</li>
							<li> Request HTTP headers or HTTP User Agent (web applications only)
							</li>
							<li> User type classification e.g. public, authenticated user, CMS user, search engine, authorized penetration tester, uptime 
monitor (see "Data to exclude" below)
							</li>
							<li> Analytical confidence in the event detection [Note B] e.g. low, medium, high or a numeric value
							</li>
							<li> Responses seen by the user and/or taken by the application e.g. status code, custom text messages, session termination, 
administrator alerts
							</li>
							<li> Extended details e.g. stack trace, system error messages, debug information, HTTP request body, HTTP response headers and body
							</li>
							<li> Internal classifications e.g. responsibility, compliance references
							</li>
							<li> External classifications e.g. NIST Security Content Automation Protocol (SCAP), Mitre Common Attack Pattern Enumeration and 
Classification (CAPEC)
							</li>
							</ul>
							<p>For more information on these, see the "other" related articles listed at the end, especially the comprehensive article by 
Anton Chuvakin and Gunnar Peterson.
							</p><p>Note A: The "Interaction identifier" is a method of linking all (relevant) events for a single user interaction (e.g. 
desktop application form submission, web page request, mobile app button click, web service call). The application knows all 
these events relate to the same interaction, and this should be recorded instead of losing the information and forcing subsequent 
correlation techniques to re-construct the separate events. For example a single SOAP request may have multiple input validation 
failures and they may span a small range of times. As another example, an output validation failure may occur much later than the 
input submission for a long-running "saga request" submitted by the application to a database server.
							</p><p>Note B: Each organisation should ensure it has a consistent, and documented, approach to classification of events (type, 
confidence, severity), the syntax of descriptions, and field lengths &amp; data types including the format used for dates/times.
							</p>
							<h5><li><span>Data to exclude</span></li></h5>
							<p>Never log data unless it is legally sanctioned. For example intercepting some communications, monitoring employees, and 
collecting some data without consent may all be illegal.
							</p><p>Never exclude any events from "known" users such as other internal systems, "trusted" third parties, search engine robots, 
uptime/process and other remote monitoring systems, pen testers, auditors. However, you may want to include a classification flag 
for each of these in the recorded data.
							</p><p>The following should not usually be recorded directly in the logs, but instead should be removed, masked, sanitized, 
hashed or encrypted:
							</p>
							<ul>
							<li> Application source code
							</li>
							<li> Session identification values (consider replacing with a hashed value if needed to track session specific events)
							</li>
							<li> Access tokens
							</li>
							<li> Sensitive personal data and some forms of personally identifiable information (PII)
							</li>
							<li> Authentication passwords
							</li>
							<li> Database connection strings
							</li>
							<li> Encryption keys
							</li>
							<li> Bank account or payment card holder data
							</li>
							<li> Data of a higher security classification than the logging system is allowed to store
							</li>
							<li> Commercially-sensitive information
							</li>
							<li> Information it is illegal to collect in the relevant jurisdiction
							</li>
							<li> Information a user has opted out of collection, or not consented to e.g. use of do not track, or where consent to collect 
has expired
							</li>
							</ul>
							<p>Sometimes the following data can also exist, and whilst useful for subsequent investigation, it may also need to be treated in 
some special manner before the event is recorded:
							</p>
							<ul>
							<li> File paths
							</li>
							<li> Database connection strings
							</li>
							<li> Internal network names and addresses
							</li>
							<li> Non sensitive personal data (e.g. personal names, telephone numbers, email addresses)
							</li>
							</ul>
							<p>In some systems, sanitization can be undertaken post log collection, and prior to log display.
							</p>
							<h5><li><span>Customizable logging</span></li></h2>
							<p>It may be desirable to be able to alter the level of logging (type of events based on severity or threat level, amount of 
detail recorded). If this is implemented, ensure that:
							</p>
							<ul>
							<li> The default level must provide sufficient detail for business needs
							</li>
							<li> It should not be possible to completely inactivate application logging or logging of events that are necessary for 
compliance requirements
							</li>
							<li> Alterations to the level/extent of logging must be intrinsic to the application (e.g. undertaken automatically by the 
application based on an approved algorithm) or follow change management processes (e.g. changes to configuration data, 
modification of source code)
							</li>
							<li> The logging level must be verified periodically
							</li>
							</ul>
							<h5><li><span>Event collection</span></li></h5>
							<p>If your development framework supports suitable logging mechanisms use, or build upon that. Otherwise, implement an 
application-wide log handler which can be called from other modules/components. Document the interface referencing the 
organisation-specific event classification and description syntax requirements. If possible create this log handler as a standard 
module that can is thoroughly tested,  deployed in multiple application, and added to a list of approved &amp; recommended  
modules.
							</p>
							<ul>
							<li> Perform input validation on event data from other trust zones to ensure it is in the correct format (and consider alerting 
and not logging if there is an input validation failure)
							</li>
							<li> Perform sanitization on all event data to prevent log injection attacks e.g. carriage return (CR), line feed (LF) and 
delimiter characters (and optionally to remove sensitive data)
							</li>
							<li> Encode data correctly for the output (logged) format
							</li>
							<li> If writing to databases, read, understand and apply the SQL injection cheat sheet
							</li>
							<li> Ensure failures in the logging processes/systems do not prevent the application from otherwise running or allow information 
leakage
							</li>
							<li> Synchronize time across all servers and devices [Note C]
							</li>
							</ul>
							<p>Note C: This is not always possible where the application is running on a device under some other party's control (e.g. on an 
individual's mobile phone, on a remote customer's workstation which is on another corporate network). In these cases attempt to 
measure the time offset, or record a confidence level in the event time stamp.
							</p><p>Where possible record data in a standard format, or at least ensure it can be exported/broadcast using an 
industry-standard format.
							</p><p>In some cases, events may be relayed or collected together in intermediate points. In the latter some data may be 
aggregated or summarized before forwarding on to a central repository and analysis system.
							</p>
							<h5><li><span>Verification</span></li></h5>
							<p>Logging functionality and systems must be included in code review, application testing and security verification processes:
							</p>
							<ul>
							<li> Ensure the logging is working correctly and as specified
							</li>
							<li> Check events are being classified consistently and the field names, types and lengths are correctly defined to an agreed 
standard
							</li>
							<li> Ensure logging is implemented and enabled during application security, fuzz, penetration and performance testing
							</li>
							<li> Test the mechanisms are not susceptible to injection attacks
							</li>
							<li> Ensure there are no unwanted side-effects when logging occurs
							</li>
							<li> Check the effect on the logging mechanisms when external network connectivity is lost (if this is usually required)
							</li>
							<li> Ensure logging cannot be used to deplete system resources, for example by filling up disk space or exceeding database 
transaction log space, leading to denial of service
							</li>
							<li> Test the effect on the application of logging failures such as simulated database connectivity loss, lack of file system 
space, missing write permissions to the file system, and runtime errors in the logging module itself
							</li>
							<li> Verify access controls on the event log data
							</li>
							<li> If log data is utilized in any action against users (e.g. blocking access, account lock-out), ensure this cannot be used to 
cause denial of service (DoS) of other users
							</li>
							</ul>
							<p><br />
							</p></ol>
							<h4><li><span>Deployment and operation</span></li></h4>
							<ol type="a">
							<h5><li><span>Release</span></li></h5>
							<ul>
							<li> Provide security configuration information by adding details about the logging mechanisms to release documentation
							</li>
							<li> Brief the application/process owner about the application logging mechanisms
							</li>
							<li> Ensure the outputs of the monitoring (see below) are integrated with incident response processes
							</li>
							</ul>
							<h5><li><span class="mw-headline" id="Operation">Operation</span></li></h5>
							<p>Enable processes to detect whether logging has stopped, and to identify tampering or unauthorized access and deletion (see 
protection below).
							</p>
							<h5><li><span class="mw-headline" id="Protection">Protection</span></li></h5>
							<p>The logging mechanisms and collected event data must be protected from mis-use such as tampering in transit, and unauthorized 
access, modification and deletion once stored. Logs may contain personal and other sensitive information, or the data may contain 
information regarding the application's code and logic. In addition, the collected information in the logs may itself have 
business value (to competitors, gossip-mongers, journalists and activists) such as allowing the estimate of revenues, or 
providing performance information about employees. This data may be held on end devices, at intermediate points, in centralized 
repositories and in archives and backups. Consider whether parts of the data may need to be excluded, masked, sanitized, hashed 
or encrypted during examination or extraction.
							</p><p>At rest:
							</p>
							<ul>
							<li> Build in tamper detection so you know if a record has been modified or deleted
							</li>
							<li> Store or copy log data to read-only media as soon as possible
							</li>
							<li> All access to the logs must be recorded and monitored (and may need prior approval)
							</li>
							<li> The privileges to read log data should be restricted and reviewed periodically
							</li>
							</ul>
							<p>In transit:
							</p>
							<ul>
							<li> If log data is sent over untrusted networks (e.g. for collection, for dispatch elsewhere, for analysis, for reporting), use 
a secure transmission protocol
							</li>
							<li> Consider whether the origin of the event data needs to be verified
							</li>
							<li> Perform due diligence checks (regulatory and security) before sending event data to third parties
							</li>
							</ul>
							<p>See NIST SP 800-92 Guide to Computer Security Log Management for more guidance.
							</p>
							<h5><li><span>Monitoring of events</span></li></h5>
							<p>The logged event data needs to be available to review and there are processes in place for appropriate monitoring, alerting 
and reporting:
							</p>
							<ul>
							<li> Incorporate the application logging into any existing log management systems/infrastructure e.g. centralized logging and 
analysis systems 
							</li>
							<li> Ensure event information is available to appropriate teams
							</li>
							<li> Enable alerting and signal the responsible teams about more serious events immediately
							</li>
							<li> Share relevant event information with other detection systems, to related organizations and centralized intelligence 
gathering/sharing systems
							</li>
							</ul>
							<h5><li><span>Disposal of logs</span></li></h5>
							<p>Log data, temporary debug logs, and backups/copies/extractions, must not be destroyed before the duration of the required data 
retention period, and must not be kept beyond this time. Legal, regulatory and contractual obligations may impact on these periods.
							</p>
							</ol>
							</ol>
							</td>
						</tr>				
		</tbody>
		</table>			
    </div>   
</div>
</body>
</html>


