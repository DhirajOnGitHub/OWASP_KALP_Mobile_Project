<!DOCTYPE HTML>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../images/splash/splash-icon.png">
<link rel="apple-touch-startup-image" href="../../images/splash-screen.png" 			media="screen and (max-device-width: 320px)" />  
<link rel="apple-touch-startup-image" href="../../images/splash-screen@2x.png" 		media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" /> 
<link rel="apple-touch-startup-image" sizes="640x1096" href="../../images/splash-screen@3x.png" />
<link rel="apple-touch-startup-image" sizes="1024x748" href="../../images/splash-screen-ipad-landscape" media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : landscape)" />
<link rel="apple-touch-startup-image" sizes="768x1004" href="./../images/splash/splash-screen-ipad-portrait.png" media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : portrait)" />
<link rel="apple-touch-startup-image" sizes="1536x2008" href="../../images/splash/splash-screen-ipad-portrait-retina.png"   media="(device-width: 768px)	and (orientation: portrait)	and (-webkit-device-pixel-ratio: 2)"/>
<link rel="apple-touch-startup-image" sizes="1496x2048" href="../../images/splash/splash-screen-ipad-landscape-retina.png"   media="(device-width: 768px)	and (orientation: landscape)	and (-webkit-device-pixel-ratio: 2)"/>

<title>OWASP TOP 10 Android App - Version 1.0</title>

<link href="../../css/style.css"     		 rel="stylesheet" type="text/css">
<link href="../../css/framework.css" 		 rel="stylesheet" type="text/css">
<link href="../../css/owl.carousel.css" 	 rel="stylesheet" type="text/css">
<link href="../../css/owl.theme.css" 		 rel="stylesheet" type="text/css">
<link href="../../css/swipebox.css"		 rel="stylesheet" type="text/css">
<link href="../../css/colorbox.css"		 rel="stylesheet" type="text/css">
<link href="../../css/font-awesome.css"	 rel="stylesheet" type="text/css">
<link href="../../css/animate.css"		 rel="stylesheet" type="text/css">

<script type="text/javascript" src="../../js/jquery.js"></script>
<script type="text/javascript" src="../../js/jqueryui.js"></script>
<script type="text/javascript" src="../../js/wow.js"></script>
<script type="text/javascript" src="../../js/owl.carousel.min.js"></script>
<script type="text/javascript" src="../../js/jquery.swipebox.js"></script>
<script type="text/javascript" src="../../js/colorbox.js"></script>
<script type="text/javascript" src="../../js/snap.js"></script>
<script type="text/javascript" src="../../js/countdown.js"></script>
<script type="text/javascript" src="../../js/contact.js"></script>
<script type="text/javascript" src="../../js/framework.js"></script>
<script type="text/javascript" src="../../js/framework.launcher.js"></script>
<script type="text/javascript" src="../../js/custom.js"></script>
<script type="text/javascript" src="../../js/table.js"></script>
<script type="text/javascript" src="../../cordova.js"></script>
<script type="text/javascript" src="../../js/hyperlink.js"></script>
<script type="text/javascript" src="../../js/initialize.js"></script>

<script>


</script>
</head>
<body>

<div id="preloader" style="display: none;">
	<div id="status" style="display: none;">
    	<p class="center-text">
			Loading the content...
            <em>please wait...</em>
        </p>
    </div>
</div>


<div class="header">
    <a class="deploy-navigation going-up">
        <i class="fa fa-navicon"></i>
    </a>
    <a class="header-logo" href="../../index.html"><img src="../../images/title/owasp_logo_header_1600_310.png" alt="img"></a>
</div>

<div class="header-clear"></div>

<div class="page-navigation full-bottom">
	<div class="nav-clear"></div>
    <div class="nav-item">
        <a href="../../index.html">
            <i class="fa fa-star"></i>				
            Welcome		
            <i class="fa fa-angle-right"></i>
        </a>
    </div>
    <div class="nav-item">
        <a href="../../homepage.html">
            <i class="fa fa-home"></i>				
            Homepage		
            <i class="fa fa-angle-right"></i>
        </a>
    </div>
	<div class="nav-item">
        <a href="../../cheatsheets.html">
            <i class="fa fa-list-alt"></i>
            Cheat Sheets
            <i class="fa fa-angle-right"></i>
        </a>       
    </div>
    <div class="nav-item">
        <a href="../../email.html">
            <i class="fa fa-envelope"></i>
            Email OWASP Top 10
            <i class="fa fa-angle-right"></i>
        </a>       
    </div>
    <div class="nav-item">
        <a href="../../download.html">
            <i class="fa fa-cloud-download"></i>
            Download OWASP Top 10
            <i class="fa fa-angle-right"></i>
        </a>        
    </div>
    <div class="nav-item">
        <a href="../../about.html">
            <i class="fa fa-info"></i>
            About OWASP KALP
            <i class="fa fa-angle-right"></i>
        </a>
        
    </div>
    <div class="nav-item">
        <a href="../../tnc.html">
            <i class="fa fa-question-circle"></i>
            Disclaimer
            <i class="fa fa-angle-right"></i>
        </a>        
    </div>
    <div class="nav-item">
        <a href="../../contact.html">
            <i class="fa fa-phone-square"></i>
            Contact	
            <i class="fa fa-angle-right"></i>
        </a>       
    </div>
    <div class="nav-item">
        <a href="#" class="close-navigation">
            <i class="fa fa-times"></i>
            Close	
            <i class="fa fa-angle-up"></i>
        </a>       
    </div>
</div>    


<div class="content" id="content">     
    <div class="container">	
		<div class="static-notification-blue">
			<p class="center-text uppercase">A3: Malicious File Execution</p>   
		</div>
		<p>Malicious file execution vulnerabilities are found in many applications. Developers will often directly use or concatenate potentially hostile input with file or stream functions, or improperly trust input files. On many platforms, frameworks allow the use of external object references, such as URLs or file system references. When the data is insufficiently checked, this can lead to arbitrary remote and hostile content being included, processed or invoked by the web server. 
			</p><p>This allows attackers to perform:
			</p>
			<ul>
			<li>Remote code execution
			</li>
			<li>Remote root kit installation and complete system compromise
			</li>
			<li>Internal system compromise may be possible through the use of PHP’s SMB file wrappers 
			</li>
			</ul>
			<p>This attack is particularly prevalent on PHP, and extreme care must be taken with any stream or file function to ensure that user supplied input does not influence file names.
		</p>
			<div class="decoration"></div>				
				<div class="static-notification-blue">
					<p class="center-text uppercase">Environments Affected</p>   
				</div>				
				<p>All web application frameworks are vulnerable to malicious file execution if they accept filenames or files from the user. Typical examples include: .NET assemblies which allow URL file name arguments, or code which accepts the user’s choice of filename to include local files.
				</p><p><b>PHP is particularly vulnerable</b> to remote file include (RFI) attack through parameter tampering with any file or streams based API.
				</p>
				<div class="decoration"></div>				
					
				<div class="static-notification-blue">
					<p class="center-text uppercase">Vulnerability</p>   
					</div>
				<p>A common vulnerable construct is:
				</p>
				<div style="border: 2px dashed #444444; background-color: #D0D0D0; font-family: courier; padding: 4px;margin-left: +20px; margin-right: +20px;">include $_REQUEST['filename’];
				</div>
				<p>Not only does this allow evaluation of remote hostile scripts, it can be used to access local file servers due to file share support in PHP.
				</p><p>Other methods of attack include:
				</p>
				<ul>
				<li>Hostile data being uploaded to session files, log data, and via image uploads (typical of forum software)
				</li>
				<li>Using compression or audio streams, such as zlib:// or ogg:// which do not inspect the internal PHP URL flag and thus allow access to remote resources even if allow_url_fopen or allow_url_include is disabled
				</li>
				<li>Using PHP wrappers, such as php://input and others to take input from the request POST data rather than a file
				</li>
				<li>Using PHP’s data: wrapper, such as 
				<div style="background-color: #D0D0D0; font-family: courier; padding: 4px;margin-left: +20px; margin-right: +20px;">
				data:;base64,PD9waHAgcGhwaW5mbygpOz8+
				</div>
				</li>
				</ul>
				<p>As this list is extensive (and periodically changes), it is vital to use a properly designed security architecture and robust design when dealing with user supplied inputs influencing the choice of server side filenames and access.
				</p><p>Although PHP examples have been given, this attack is also applicable in different ways to .NET and J2EE. Applications written in those frameworks need to pay particular attention to code access security mechanisms to ensure that filenames supplied by or influenced by the user do not allow security controls to be obviated.
				</p><p>For example, it is possible that XML documents submitted by an attacker will have a hostile DTD that forces the XML parser to load a remote DTD, and parse and process the results. An Australian security firm has demonstrated this approach to port scanning behind firewalls. See [SIF01] in this chapter’s references for more information. 
				</p><p>The damage this particular vulnerability causes is directly related to the strength of the sandbox / platform isolation controls in the framework. As PHP is rarely isolated and has no sandbox concept or security architecture, the damage is far worse for an attack than other platforms with limited or partial trust, or are contained within a suitable sand box, such as when a web app is running under a JVM with the security manager properly enabled and configured (which is rarely the default). 
				</p>
				<div class="decoration"></div>
								
				<div class="static-notification-blue">
					<p class="center-text uppercase">Verifying Security</p>   
				</div>	
				<p>Automated approaches: Vulnerability scanning tools will have difficulty identifying the parameters that are used in a file include or the syntax for making them work. Static analysis tools can search for the use of dangerous APIs, but cannot verify that appropriate validation or encoding might be in place to protect against the vulnerability.
				</p><p>Manual approaches: A code review can search for code that might allow a file to be included in the application, but there are many possible mistakes to recognize. Testing can also detect these vulnerabilities, but identifying the particular parameters and the right syntax can be difficult.
				</p>
				<div class="decoration"></div>
				<div class="static-notification-blue">
					<p class="center-text uppercase">Protection</p>   
				</div>				
		<p>Preventing remote file include flaws takes some careful planning at the architectural and design phases, through to thorough testing. In general, a well-written application will not use user-supplied input in any filename for any server-based resource (such as images, XML and XSL transform documents, or script inclusions), and will have firewall rules in place preventing new outbound connections to the Internet or internally back to any other server. However, many legacy applications will continue to have a need to accept user supplied input. 
			</p><p>Among the most important considerations are:
			</p>
			<ul>
			<li><b>Use an indirect object reference map</b> (see section A4 for more details). For example, where a partial filename was once used, consider a hash of the partial reference. Instead of&#160;:
			</li>
			</ul>
			<div style="border: 2px dashed #444444; background-color: #D0D0D0; font-family: courier; padding: 4px;margin-left: +20px; margin-right: +20px;"><code>&lt;select name=”language”&gt;<br>
			   &lt;option value=”English”&gt;English&lt;/option&gt;</code>
			</div>
			<p>use
			</p>
			<div style="border: 2px dashed #444444; background-color: #D0D0D0; font-family: courier; padding: 4px;margin-left: +20px; margin-right: +20px;"><code>&lt;select name=”language”&gt;<br>
			   &lt;option value=”78463a384a5aa4fad5fa73e2f506ecfc”&gt;English&lt;/option&gt;</code>
			</div>
			<p>Consider using salts to prevent brute forcing of the indirect object reference. Alternatively, just use index values such as 1, 2, 3, and ensure that the array bounds are checked to detect parameter tampering.
			</p>
			<ul>
			<li><b>Use explicit taint checking mechanisms</b>, if your language supports it. Otherwise, consider a variable naming scheme to assist with taint checking:
			</li>
			</ul>
			<div style="border: 2px dashed #444444; background-color: #D0D0D0; font-family: courier; padding: 4px;margin-left: +20px; margin-right: +20px;">$hostile = &amp;$_POST; // refer to POST variables, not $_REQUEST</br>
			<code>$safe[‘filename’]= validate_file_name($hostile[‘unsafe_filename’]); // make it safe</code>
			</div>
			<p>Therefore any operation based upon hostile input is immediately obvious:
			</p>
			<div style="border: 2px dashed #444444; background-color: #D0D0D0; font-family: courier; padding: 4px;margin-left: +20px; margin-right: +20px;">WRONG: <span style="color: red">require_once($_POST[‘unsafe_filename’] . ‘inc.php’);</span><br>
			<code>RIGHT: require_once($safe[‘filename’] . ‘inc.php’);</code>
			</div>
			<ul>
			<li><b>Strongly validate user</b> input using "accept known good" as a strategy
			</li>
			<li><b>Add firewall</b> rules to prevent web servers making new connections to external web sites and internal systems. For high value systems, isolate the web server in its own VLAN or private subnet 
			</li>
			<li><b>Check any user supplied files or filenames</b> taken from the user for legitimate purposes, which cannot obviate other controls. Otherwise be obviated, tainting could include user supplied data in the session object, avatars and images, PDF reports, temporary files, and so on
			</li>
			<li><b>Consider implementing a chroot jail </b>or other sand box mechanisms such as virtualization to isolate applications from each other
			</li>
			<li><b>PHP:</b> <b>Disable allow_url_fopen and allow_url_include</b> in php.ini and consider building PHP locally to not include this functionality. Very few applications need this functionality and thus these settings should be enabled on a per application basis
			</li>
			<li><b>PHP: Disable register_globals and use E_STRICT to find uninitialized variables</b>
			</li>
			<li><b>PHP: Ensure that all file and streams functions (stream_*)</b> <b>are carefully vetted</b>. Ensure that the user input is not supplied any function which takes a filename argument, including:
			</li>
			</ul>
			<p><code>include() include_once() require() require_once() fopen() imagecreatefromXXX() file() file_get_contents() copy() delete() unlink() upload_tmp_dir() $_FILES move_uploaded_file()</code>
			</p>
			<ul>
			<li>PHP: Be extremely cautious if data is passed to system() eval() passthru() or ` (the backtick operator).
			</li>
			<li>With J2EE, ensure that the security manager is enabled and properly configured and that the application is demanding permissions appropriately
			</li>
			<li>With ASP.NET, please refer to the documentation on partial trust, and design your applications to be segmented in trust, so that most of the application exists in the lowest possible trust state possible
			</li>
			</ul>
				
					<div class="decoration"></div>
				<div class="static-notification-blue">
					<p class="center-text uppercase">Samples</p>   
				</div>
				<ul>
					<li><a id="hyperlink" href="javascript:loadURL('https://www.owasp.orghttp://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-0360');">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-0360</a>
					</li>
					<li><a id="hyperlink" href="javascript:loadURL('https://www.owasp.orghttp://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5220');">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5220</a>    
					</li>
					<li><a id="hyperlink" href="javascript:loadURL('http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-4722');">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-4722</a> 
					</li>
				</ul>
				<div class="static-notification-blue">
					<p class="center-text uppercase">References</p>   
				</div>
				<ul>
				<li>CWE: CWE-98 (PHP File Inclusion), CWE-78 (OS Command Injection), CWE-95 (Eval injection), CWE-434 (Unrestricted file upload)
				</li>
				<li>WASC Threat Classification: 
				</li>
				</ul>
				<p><a id="hyperlink" href="javascript:loadURL('http://www.webappsec.org/projects/threat/classes/os_commanding.shtml');">http://www.webappsec.org/projects/threat/classes/os_commanding.shtml</a>
				</p>
				<ul>
				<li>OWASP Development Guide, <a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/File_System#Includes_and_Remote_files');" title="File System">Includes and Remote Files</a>
				</li>
				<li>OWASP Testing Guide, <a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/Testing_for_Path_Traversal_(OWASP-AZ-001)');" title="Testing for Path Traversal (OWASP-AZ-001)" class="mw-redirect">Testing for Path Traversal</a>
				</li>
				<li>OWASP PHP Top 5, <a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/PHP_Top_5#P1:_Remote_Code_Execution');" title="PHP Top 5">Remote Code Execution</a> 
				</li>
				<li>Stefan Esser,
				</li>
				</ul>
				<p><a id="hyperlink" href="javascript:loadURL('http://blog.php-security.org/archives/45-PHP-5.2.0-and-allow_url_include.html');">http://blog.php-security.org/archives/45-PHP-5.2.0-and-allow_url_include.html</a> 
				</p>
				<ul>
				<li>[SIF01] SIFT,Sift Networks, Web Services: Teaching an old dog new tricks, <a id="hyperlink" href="javascript:loadURL('http://www.ruxcon.org.au/files/2006/web_services_security.ppt');">http://www.ruxcon.org.au/files/2006/web_services_security.ppt</a> 
				</li>
				<li><a id="hyperlink" href="javascript:loadURL('https://www.owasp.org/index.php/OWASP_Java_Table_of_Contents#Defining_a_Java_Security_Policy');" title="OWASP Java Table of Contents">Defining a Java Security Policy</a> 
				</li>
				<li>Microsoft - Programming for Partial Trust, <a id="hyperlink" href="javascript:loadURL('http://msdn2.microsoft.com/en-us/library/ms364059(VS.80).aspx');">http://msdn2.microsoft.com/en-us/library/ms364059(VS.80).aspx</a> 
				</li>
				</ul>
				<div class="decoration"></div>
    </div>    
</div>
<div class="decoration"></div>
</body>
</html>


